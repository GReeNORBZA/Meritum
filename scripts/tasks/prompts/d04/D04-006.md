# Task D04-006: Zod validation schemas for import, template, shift, export, and preferences endpoints

## Project Context
- Monorepo: Turborepo + pnpm workspaces
- API: `apps/api` (Fastify 5, TypeScript)
- Shared: `packages/shared` (Drizzle schemas, Zod validators, constants)
- DB: PostgreSQL 16 with Drizzle ORM
- Test: Vitest + Supertest
- Auth: Lucia sessions with RBAC middleware from Domain 1
- All queries MUST include physician_id for tenant isolation (HIA custodian boundary)
- Claims contain PHI — no PHI in logs, errors, or emails. PHN masked as 123******
- State machine: 11 states, 5 terminal. Transitions enforced at service layer.

## What to Build

Add to `packages/shared/src/schemas/claim.schema.ts`:

**EMR Import:**
- createImportSchema: { field_mapping_template_id: uuid().optional() } (file uploaded separately via multipart)
- commitImportSchema: { } (no body, import_batch_id from path)
- importIdParamSchema: { id: uuid() }

**Field mapping templates:**
- createTemplateSchema: { name: string().min(1).max(100), emr_type: string().max(50).optional(), mappings: array of {source_column: string(), target_field: string(), transform: string().optional()}.min(1), delimiter: string().max(5).optional(), has_header_row: boolean(), date_format: string().max(20).optional() }
- updateTemplateSchema: same as create but all fields optional
- templateIdParamSchema: { id: uuid() }

**ED Shift:**
- createShiftSchema: { facility_id: uuid(), shift_date: date string, start_time: time string optional, end_time: time string optional }
- addEncounterSchema: { patient_id: uuid(), date_of_service: date string, claim_type: enum('AHCIP','WCB') } (plus pathway-specific fields)
- shiftIdParamSchema: { id: uuid() }

**Data export:**
- createExportSchema: { date_from: date string, date_to: date string, claim_type: enum('AHCIP','WCB').optional(), format: enum('CSV','JSON').default('CSV') }
- exportIdParamSchema: { id: uuid() }

**Submission preferences:**
- updatePreferencesSchema: { mode: enum('AUTO_CLEAN','AUTO_ALL','REQUIRE_APPROVAL') }

Export all schemas and inferred types.

## FRD References

- Domain 4.0 Section 6.2: EMR import endpoints — upload, preview, commit.
- Domain 4.0 Section 6.3: Field mapping template CRUD.
- Domain 4.0 Section 6.4: ED shift workflow — create shift, add encounter, complete, get details.
- Domain 4.0 Section 6.7: Data export — request export, check status/download.
- Domain 4.0 Section 6.8: Submission preferences — get/update auto-submission mode.

## Dependencies

- D04-001 must be complete (claim constants for enum values).
- D04-005 must be complete (base claim schemas exist in claim.schema.ts).

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

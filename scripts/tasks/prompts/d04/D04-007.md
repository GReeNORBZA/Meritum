# Task D04-007: Generate and apply database migration for all claim tables

## Project Context
- Monorepo: Turborepo + pnpm workspaces
- API: `apps/api` (Fastify 5, TypeScript)
- Shared: `packages/shared` (Drizzle schemas, Zod validators, constants)
- DB: PostgreSQL 16 with Drizzle ORM
- Test: Vitest + Supertest
- Auth: Lucia sessions with RBAC middleware from Domain 1
- All queries MUST include physician_id for tenant isolation (HIA custodian boundary)
- Claims contain PHI â€” no PHI in logs, errors, or emails. PHN masked as 123******
- State machine: 11 states, 5 terminal. Transitions enforced at service layer.

## What to Build

Run the Drizzle migration generator to create the migration for all Claim Lifecycle tables:

```bash
cd apps/api
pnpm drizzle-kit generate
pnpm drizzle-kit migrate
```

Verify that the migration file was created in `apps/api/drizzle/migrations/`.
Verify that all 5 tables exist in the test database: claims, import_batches, field_mapping_templates, shifts, claim_audit_history.
Verify all indexes and constraints are applied.
Verify FKs to providers (Domain 5) and patients (Domain 6) resolve correctly.

## Dependencies

- D04-002 must be complete (claims table schema).
- D04-003 must be complete (import_batches and field_mapping_templates schemas).
- D04-004 must be complete (shifts and claim_audit_history schemas).

## Run After Completion

```bash
cd apps/api && pnpm drizzle-kit generate 2>&1 && pnpm drizzle-kit migrate 2>&1
```

All tests must pass before outputting [TASK_COMPLETE].

# Task D04-099: Full domain test suite — all unit + integration + security tests

## Project Context
- Monorepo: Turborepo + pnpm workspaces
- API: `apps/api` (Fastify 5, TypeScript)
- Shared: `packages/shared` (Drizzle schemas, Zod validators, constants)
- DB: PostgreSQL 16 with Drizzle ORM
- Test: Vitest + Supertest
- Auth: Lucia sessions with RBAC middleware from Domain 1
- All queries MUST include physician_id for tenant isolation (HIA custodian boundary)
- Claims contain PHI — no PHI in logs, errors, or emails. PHN masked as 123******
- State machine: 11 states, 5 terminal. Transitions enforced at service layer.

## What to Build

Run the complete test suite for Domain 4.0 Claim Lifecycle Core. Do NOT write new code unless tests fail.

1. Run all unit tests: `pnpm --filter api vitest run src/domains/claim/`
2. Run all integration tests: `pnpm --filter api vitest run test/integration/claim/`
3. Run all security tests: `pnpm --filter api vitest run test/security/claim/`

If any tests fail: read the failure, fix the source code (not the tests unless the test is wrong), re-run.

After all pass, run the full suite one final time:
```bash
pnpm --filter api vitest run src/domains/claim/ test/integration/claim/ test/security/claim/
```

Verify these security test files exist and are non-empty:
- test/security/claim/claim.authn.security.ts
- test/security/claim/claim.authz.security.ts
- test/security/claim/claim.scoping.security.ts
- test/security/claim/claim.input.security.ts
- test/security/claim/claim.leakage.security.ts
- test/security/claim/claim.audit.security.ts

## Dependencies

- D04-040 must be complete (authentication security tests).
- D04-041 must be complete (authorization security tests).
- D04-042 must be complete (tenant isolation security tests).
- D04-043 must be complete (input validation security tests).
- D04-044 must be complete (data leakage security tests).
- D04-045 must be complete (audit trail security tests).

## Run After Completion

```bash
pnpm --filter api vitest run src/domains/claim/ test/integration/claim/ test/security/claim/
```

All tests must pass before outputting [TASK_COMPLETE].

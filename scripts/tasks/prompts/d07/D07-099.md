# D07-099: Full domain test suite: all unit + integration + security tests for Intelligence Engine

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

Read `CLAUDE.md` in the project root for full conventions (naming, structure, error handling, security, testing).

## Dependencies
This task depends on: **D07-040**, **D07-041**, **D07-042**, **D07-043**, **D07-044**, **D07-045** (all security tests must exist).

## What to Build
Run the complete test suite for Domain 7 Intelligence Engine. Do NOT write new code unless tests fail.

1. Run all unit tests: `pnpm --filter api vitest run src/domains/intel/`
2. Run all integration tests: `pnpm --filter api vitest run test/integration/intelligence/`
3. Run all security tests: `pnpm --filter api vitest run test/security/intelligence/`

If any tests fail: read the failure, fix the source code (not the tests unless the test is wrong), re-run.

After all pass, run the full suite one final time:
```bash
pnpm --filter api vitest run src/domains/intel/ test/integration/intelligence/ test/security/intelligence/
```

Verify these security test files exist and are non-empty:
- test/security/intelligence/intelligence.authn.security.ts
- test/security/intelligence/intelligence.authz.security.ts
- test/security/intelligence/intelligence.scoping.security.ts
- test/security/intelligence/intelligence.input.security.ts
- test/security/intelligence/intelligence.leakage.security.ts
- test/security/intelligence/intelligence.audit.security.ts

Verify all 4 Intelligence Engine tables have CRUD coverage.
Verify all 14 API endpoints have integration test coverage.
Verify MVP rule seed runs successfully with ~105 rules.
Verify LLM PHI isolation tests pass.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter api vitest run src/domains/intel/ test/integration/intelligence/ test/security/intelligence/
```
Fix any errors before finishing.

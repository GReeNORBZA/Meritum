# D07-003: Drizzle schema for ai_provider_learning and ai_specialty_cohorts tables

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

Read `CLAUDE.md` in the project root for full conventions (naming, structure, error handling, security, testing).

## Dependencies
This task depends on: **D07-002** (ai_rules table must exist).

## What to Build
Add to `packages/shared/src/schemas/db/intelligence.schema.ts`:

**ai_provider_learning table (per-physician per-rule learning state):**

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| learning_id | UUID | No | PK |
| provider_id | UUID FK | No | FK -> providers |
| rule_id | UUID FK | No | FK -> ai_rules |
| times_shown | INTEGER | No | DEFAULT 0. Total times rule generated suggestion |
| times_accepted | INTEGER | No | DEFAULT 0 |
| times_dismissed | INTEGER | No | DEFAULT 0 |
| consecutive_dismissals | INTEGER | No | DEFAULT 0. Resets on acceptance |
| is_suppressed | BOOLEAN | No | DEFAULT false. True when consecutive_dismissals >= 5 |
| priority_adjustment | INTEGER | No | DEFAULT 0. -1 demote, 0 no change, +1 promote |
| last_shown_at | TIMESTAMPTZ | Yes | |
| last_feedback_at | TIMESTAMPTZ | Yes | |
| created_at | TIMESTAMPTZ | No | |
| updated_at | TIMESTAMPTZ | No | |

Constraint: UNIQUE(provider_id, rule_id). Created lazily on first suggestion.
Indexes: (provider_id, is_suppressed), (rule_id).

**ai_specialty_cohorts table (aggregate rates per specialty per rule):**

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| cohort_id | UUID | No | PK |
| specialty_code | VARCHAR(10) | No | |
| rule_id | UUID FK | No | FK -> ai_rules |
| physician_count | INTEGER | No | Min 10 for use |
| acceptance_rate | DECIMAL(5,4) | No | 0.0000-1.0000 |
| median_revenue_impact | DECIMAL(10,2) | Yes | |
| updated_at | TIMESTAMPTZ | No | Last recalculation |

Constraint: UNIQUE(specialty_code, rule_id).
Index: (specialty_code).

Export tables and inferred types.

## FRD References
- Domain 7 Section 7.2: ai_provider_learning (13 columns). Lazy creation, UNIQUE on provider+rule. Suppression at 5 consecutive dismissals.
- Domain 7 Section 7.3: ai_specialty_cohorts (7 columns). Nightly update. Minimum 10 physicians per cohort.

## Tests
No specific unit tests for this task — verified by build command.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter shared build
```
Fix any errors before finishing.

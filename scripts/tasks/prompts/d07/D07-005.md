# D07-005: Zod validation schemas for all Intelligence Engine API endpoints

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

Read `CLAUDE.md` in the project root for full conventions (naming, structure, error handling, security, testing).

## Dependencies
This task depends on: **D07-001** (Intelligence constants must exist).

## What to Build
Create `packages/shared/src/schemas/intelligence.schema.ts` with Zod schemas:

**Suggestion Endpoints (consumed by Domain 4):**
- analyseClaimSchema: { claim_id: uuid(), claim_context: object({ claim_type, health_service_code, modifiers, date_of_service, provider_specialty, patient_demographics_anonymised, ... }) }
- claimSuggestionsParamSchema: { claim_id: uuid() }
- suggestionIdParamSchema: { id: uuid() }
- acceptSuggestionSchema: {} (suggestion ID in URL, no body needed)
- dismissSuggestionSchema: { reason: string().max(500).optional() }

**Suggestion response schema (for JSONB validation):**
- suggestionSchema: { suggestion_id: uuid(), tier: number().int().min(1).max(3), category: enum(CATEGORIES), priority: enum(PRIORITIES), title: string().max(200), description: string(), revenue_impact: number().nullable(), confidence: number().min(0).max(1).nullable(), source_reference: string().max(200), source_url: string().url().max(500).optional(), suggested_changes: array(object({ field, current_value, suggested_value })).nullable(), status: enum(STATUSES), dismissed_reason: string().nullable(), created_at: datetime(), resolved_at: datetime().nullable(), resolved_by: uuid().nullable() }

**Learning & Preferences:**
- unsuppressRuleParamSchema: { rule_id: uuid() }
- updatePreferencesSchema: { enabled_categories: array(enum(CATEGORIES)).optional(), disabled_categories: array(enum(CATEGORIES)).optional(), priority_thresholds: object({ high_revenue, medium_revenue }).optional() }

**Rule Management (Admin):**
- createRuleSchema: { name: string().max(100), category: enum(CATEGORIES), claim_type: enum(CLAIM_TYPES), conditions: object() (JSONB condition tree), suggestion_template: object() (JSONB template), specialty_filter: array(string()).nullable(), priority_formula: string().max(100), somb_version: string().max(20).optional() }
- updateRuleSchema: partial of createRuleSchema
- ruleIdParamSchema: { id: uuid() }
- activateRuleSchema: { is_active: boolean() }
- ruleListQuerySchema: { category: enum(CATEGORIES).optional(), claim_type: enum(CLAIM_TYPES).optional(), is_active: boolean().optional(), page: number().default(1), page_size: number().max(100).default(50) }

**SOMB Change Analysis:**
- sombChangeAnalysisSchema: { old_version: string(), new_version: string() }

Export all schemas and inferred TypeScript types.

## FRD References
- Domain 7 Section 8: All 4 API endpoint groups — suggestion endpoints (4), learning/preferences (3), rule management (6), SOMB analysis (1). Total 14 endpoints.
- Domain 7 Section 2.1: Suggestion structure (16 fields).

## Tests
No specific unit tests for this task — verified by build command.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter shared build
```
Fix any errors before finishing.

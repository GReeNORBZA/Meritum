# D07-004: Drizzle schema for ai_suggestion_events audit table

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

Read `CLAUDE.md` in the project root for full conventions (naming, structure, error handling, security, testing).

## Dependencies
This task depends on: **D07-002** (ai_rules table must exist).

## What to Build
Add to `packages/shared/src/schemas/db/intelligence.schema.ts`:

**ai_suggestion_events table (append-only audit log):**

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| event_id | UUID | No | PK |
| claim_id | UUID FK | No | FK -> claims |
| suggestion_id | UUID | No | Suggestion ID from claim's JSONB |
| rule_id | UUID FK | Yes | FK -> ai_rules. Null for Tier 2/3 not from rule library |
| provider_id | UUID FK | No | FK -> providers |
| event_type | VARCHAR(20) | No | GENERATED, ACCEPTED, DISMISSED, SUPPRESSED, UNSUPPRESSED |
| tier | INTEGER | No | 1, 2, or 3 |
| category | VARCHAR(30) | No | Suggestion category |
| revenue_impact | DECIMAL(10,2) | Yes | Revenue impact at time of event |
| dismissed_reason | TEXT | Yes | For DISMISSED events |
| created_at | TIMESTAMPTZ | No | |

**CRITICAL:** Append-only. No UPDATE or DELETE operations. Same pattern as Domain 1 audit_log.

Indexes: (claim_id), (provider_id, created_at DESC), (rule_id, event_type), (category, created_at DESC).

Export table and inferred types.

## Security Requirements
- Append-only: the repository must NOT expose update or delete functions for this table.
- dismissed_reason is free-text from physician — must be sanitised before storage (no SQL/XSS).
- No PHI stored in this table — only billing metadata (suggestion IDs, categories, revenue impacts).

## FRD References
- Domain 7 Section 7.4: ai_suggestion_events (11 columns). Append-only. Used for learning loop analysis and platform metrics.

## Tests
No specific unit tests for this task — verified by build command.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter shared build
```
Fix any errors before finishing.

# D08-002: Drizzle schema for analytics_cache table

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

Read `CLAUDE.md` in the project root for full conventions (naming, structure, error handling, security, testing).

## Dependencies
This task depends on: **D08-001** (analytics constants must exist first).

## What to Build
Create `packages/shared/src/schemas/db/analytics.schema.ts` starting with the analytics_cache table.

**analytics_cache table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| cache_id | UUID | PK | Default: gen_random_uuid() |
| provider_id | UUID FK | NOT NULL | FK to providers. Indexed. |
| metric_key | VARCHAR(50) | NOT NULL | One of the METRIC_KEYS constants |
| period_start | DATE | NOT NULL | Start of period this metric covers |
| period_end | DATE | NOT NULL | End of period |
| dimensions | JSONB | NULLABLE | Breakdown dims: {ba_number, location_id, claim_type, hsc_code}. Null for top-level aggregates. |
| value | JSONB | NOT NULL | Metric value(s). Structure varies by metric_key. |
| computed_at | TIMESTAMPTZ | NOT NULL | When this cache entry was last computed |

**Indexes:**
- UNIQUE on (provider_id, metric_key, period_start, period_end, dimensions) — upsert target
- Index on (provider_id, metric_key) for dashboard queries
- Index on computed_at for stale cache detection

Export table and inferred types (InsertAnalyticsCache, SelectAnalyticsCache).

## FRD References
- Domain 8 Section 7.1: analytics_cache table schema (Table 11). Pre-computed aggregates refreshed periodically.
- Domain 8 Section 10.1: Cache refresh — nightly batch + event-driven incremental + stale-cache detection on dashboard open.

## Security Considerations
- provider_id scoping is critical. All cache queries MUST filter by provider_id from the authenticated session.
- JSONB value field may contain PHI-derived aggregates. Encrypted at rest via PostgreSQL TDE.

## Tests
No specific unit tests for this task — verified by build command.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter shared build
```
Fix any errors before finishing.

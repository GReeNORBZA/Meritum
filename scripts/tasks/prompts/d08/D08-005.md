# D08-005: Zod validation schemas for all API inputs

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

Read `CLAUDE.md` in the project root for full conventions (naming, structure, error handling, security, testing).

## Dependencies
This task depends on: **D08-001** (analytics constants must exist first).

## What to Build
Create `packages/shared/src/schemas/validation/analytics.validation.ts` with Zod schemas for all API inputs:

**Dashboard query params:**
- PeriodParamsSchema: { period: enum(TIME_PERIODS), start_date?: ISO date, end_date?: ISO date }. start_date/end_date required when period is CUSTOM_RANGE.
- DashboardFilterSchema: { claim_type?: enum(AHCIP, WCB, BOTH), ba_number?: string, location_id?: UUID, claim_state?: string[], hsc_code?: string }
- RevenueQuerySchema: PeriodParamsSchema.merge(DashboardFilterSchema)
- RejectionQuerySchema: PeriodParamsSchema.merge({ claim_type?: enum, hsc_code?: string })
- AgingQuerySchema: { claim_type?: enum(AHCIP, WCB, BOTH) }
- WcbQuerySchema: PeriodParamsSchema.merge({ form_type?: string })
- AiCoachQuerySchema: PeriodParamsSchema
- MultiSiteQuerySchema: PeriodParamsSchema.merge({ compare_locations?: UUID[] }). compare_locations max 2 items for side-by-side.
- KpiQuerySchema: PeriodParamsSchema.merge(DashboardFilterSchema)

**Report generation:**
- AccountantReportSchema: { period_start: ISO date, period_end: ISO date, format: enum('csv', 'pdf_summary', 'pdf_detail') }
- DataPortabilitySchema: { password?: string (optional encryption password, min 12 chars if provided) }
- ReportIdParamSchema: { id: UUID }
- ReportListQuerySchema: { report_type?: enum(REPORT_TYPES), start_date?: ISO date, end_date?: ISO date, limit?: number(1-100, default 20), offset?: number }

**Subscriptions:**
- CreateSubscriptionSchema: { report_type: enum(subscribable report types), frequency: enum(FREQUENCIES), delivery_method: enum(DELIVERY_METHODS, default IN_APP) }
- UpdateSubscriptionSchema: { frequency?: enum, delivery_method?: enum, is_active?: boolean }. At least one field required.
- SubscriptionIdParamSchema: { id: UUID }

All date inputs validated as ISO 8601 date strings. All UUIDs validated as v4 format. Custom range validated: end_date >= start_date, max range 2 years.

Export all schemas.

## FRD References
- Domain 8 Section 9.1: Dashboard endpoints with query params (Table 15).
- Domain 8 Section 9.2: Report endpoints with body schemas (Table 16).
- Domain 8 Section 9.3: Subscription endpoints with body schemas (Table 17).
- Domain 8 Section 3.1-3.2: Period selection and filter specifications.

## Security Considerations
- All UUID inputs validated as v4 format to prevent injection.
- Date range max 2 years to prevent excessive query load.
- DataPortabilitySchema password min 12 chars if provided — encourage strong encryption.

## Tests
No specific unit tests for this task — verified by build command.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter shared build
```
Fix any errors before finishing.

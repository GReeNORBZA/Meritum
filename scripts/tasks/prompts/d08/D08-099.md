# D08-099: Full domain test suite: all unit + integration + security tests

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

Read `CLAUDE.md` in the project root for full conventions (naming, structure, error handling, security, testing).

## Dependencies
This task depends on: **D08-040**, **D08-041**, **D08-042**, **D08-043**, **D08-044**, **D08-045** (all security tests must exist first).

## What to Build
Run the complete test suite for Domain 8 Analytics & Reporting. Do NOT write new code unless tests fail.

1. Run all unit tests: `pnpm --filter api vitest run src/domains/analytics/`
2. Run all integration tests: `pnpm --filter api vitest run test/integration/analytics/`
3. Run all security tests: `pnpm --filter api vitest run test/security/analytics/`

If any tests fail: read the failure, fix the source code (not the tests unless the test is wrong), re-run.

After all pass, run the full suite one final time:
```bash
pnpm --filter api vitest run src/domains/analytics/ test/integration/analytics/ test/security/analytics/
```

Verify these security test files exist and are non-empty:
- test/security/analytics/analytics.authn.security.ts
- test/security/analytics/analytics.authz.security.ts
- test/security/analytics/analytics.scoping.security.ts
- test/security/analytics/analytics.input.security.ts
- test/security/analytics/analytics.leakage.security.ts
- test/security/analytics/analytics.audit.security.ts

Verify all Domain 8 API endpoints are registered and reachable:
- 7 dashboard GET endpoints
- 5 report endpoints (2 POST, 3 GET)
- 4 subscription endpoints (GET, POST, PUT, DELETE)

Total: 16 routes, 3 DB tables, 6 security test suites.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter api vitest run src/domains/analytics/ test/integration/analytics/ test/security/analytics/
```
Fix any errors before finishing.

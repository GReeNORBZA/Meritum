# D04W-014: Repository: return file and remittance record operations

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

## What to Build
Add to `apps/api/src/domains/wcb/wcb.repository.ts`:

**Return Records:**
- `createReturnRecords(wcbBatchId: string, records: ReturnRecordInput[])` — bulk insert return records for a batch.
- `createReturnInvoiceLines(wcbReturnRecordId: string, lines: ReturnInvoiceLineInput[])` — bulk insert per-report invoice line results.
- `getReturnRecordsByBatch(wcbBatchId: string)` — fetch all return records for a batch with invoice line sub-records.
- `matchReturnToClaimBySubmitterTxnId(submitterTxnId: string)` — lookup wcb_claim_details by submitter_txn_id. Return wcb_claim_detail_id or null.

**Remittance Records:**
- `createRemittanceImport(physicianId: string)` — create remittance import batch record. Return remittance_import_id.
- `createRemittanceRecords(remittanceImportId: string, records: RemittanceRecordInput[])` — bulk insert.
- `matchRemittanceToClaimByTxnId(electronicReportTxnId: string)` — lookup via return_records chain: electronic_report_txn_id -> wcb_return_records.report_txn_id -> wcb_claim_detail_id.
- `listRemittanceImports(physicianId: string, filters: { start_date?, end_date?, page, page_size })` — paginated list.
- `getRemittanceDiscrepancies(remittanceImportId: string)` — return records where payment_amount != billed_amount or payment_status != 'ISS'.

## Dependencies
This task depends on: D04W-009

## Tests
- createReturnRecords inserts batch of return records
- createReturnInvoiceLines inserts per-report lines
- matchReturnToClaimBySubmitterTxnId finds correct claim
- matchReturnToClaimBySubmitterTxnId returns null for unknown txn ID
- createRemittanceRecords inserts records
- matchRemittanceToClaimByTxnId follows report_txn_id chain
- getRemittanceDiscrepancies returns only mismatched records

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter api vitest run src/domains/wcb/wcb.test.ts
```
Fix any errors before finishing.

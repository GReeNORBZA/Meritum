# D04W-004: Drizzle schema for wcb_claim_details — RTW, invoice correction, and OIS-specific fields (~56 additional columns)

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

## What to Build
Add to wcb_claim_details in `packages/shared/src/schemas/db/wcb.schema.ts`:

**Return to Work Fields (C050E/S, C151/S):**

| Column | Type | Nullable | Notes |
|--------|------|----------|-------|
| missed_work_beyond_accident | VARCHAR(1) | Yes | Y/N. Triggers RTW cascade |
| patient_returned_to_work | VARCHAR(1) | Yes | Required when missed_work = Y |
| date_returned_to_work | DATE | Yes | Required when returned = Y |
| modified_hours | VARCHAR(1) | Yes | Y/N. Required when returned = Y |
| hours_capable_per_day | SMALLINT | Yes | Required when modified_hours = Y |
| modified_duties | VARCHAR(1) | Yes | Y/N. Required when returned = Y |
| rtw_hospitalized | VARCHAR(1) | Yes | |
| rtw_self_reported_pain | VARCHAR(1) | Yes | |
| rtw_opioid_side_effects | VARCHAR(1) | Yes | |
| rtw_other_restrictions | TEXT | Yes | Max 2048 |
| estimated_rtw_date | DATE | Yes | Required when missed_work = Y and returned = N |

**Invoice Correction Fields (C570 Only):**

| Column | Type | Nullable | Notes |
|--------|------|----------|-------|
| reassessment_comments | TEXT | Yes | Max 2048 |

**OIS Hand Grasping Assessment (12 fields, C050S/C151S):**

| Column | Type | Nullable |
|--------|------|----------|
| grasp_right_level | VARCHAR(10) | Yes* |
| grasp_right_prolonged | VARCHAR(1) | Yes |
| grasp_right_repetitive | VARCHAR(1) | Yes |
| grasp_right_vibration | VARCHAR(1) | Yes |
| grasp_right_specify | VARCHAR(1) | Yes |
| grasp_right_specific_desc | TEXT | Yes |
| grasp_left_level | VARCHAR(10) | Yes* |
| grasp_left_prolonged | VARCHAR(1) | Yes |
| grasp_left_repetitive | VARCHAR(1) | Yes |
| grasp_left_vibration | VARCHAR(1) | Yes |
| grasp_left_specify | VARCHAR(1) | Yes |
| grasp_left_specific_desc | TEXT | Yes |

**OIS Zone-Specific Lifting (6 fields):**

| Column | Type | Nullable |
|--------|------|----------|
| lift_floor_to_waist | VARCHAR(10) | Yes* |
| lift_floor_to_waist_max | VARCHAR(10) | Yes |
| lift_waist_to_shoulder | VARCHAR(10) | Yes* |
| lift_waist_to_shoulder_max | VARCHAR(10) | Yes |
| lift_above_shoulder | VARCHAR(10) | Yes* |
| lift_above_shoulder_max | VARCHAR(10) | Yes |

**OIS Directional Reaching (4 fields):**
reach_above_right_shoulder, reach_below_right_shoulder, reach_above_left_shoulder, reach_below_left_shoulder — all VARCHAR(10), Yes*.

**OIS Environmental Restrictions (8 fields):**
environment_restricted VARCHAR(1) No*; env_cold, env_hot, env_wet, env_dry, env_dust, env_lighting, env_noise — all VARCHAR(1) Yes* (required when environment_restricted = Y).

**OIS Assessment Summary (~29 fields):**
ois_reviewed_with_patient VARCHAR(1), ois_fitness_assessment VARCHAR(10) (FIT/NOTFIT), ois_estimated_rtw_date DATE, ois_rtw_level VARCHAR(10), ois_followup_required VARCHAR(1), ois_followup_date DATE,
ois_emp_modified_work_required VARCHAR(1), ois_emp_modified_from_date DATE, ois_emp_modified_to_date DATE, ois_emp_modified_available VARCHAR(1), ois_emp_available_from_date DATE, ois_emp_available_to_date DATE, ois_emp_comments TEXT,
ois_worker_rtw_date DATE, ois_worker_modified_duration VARCHAR(50), ois_worker_diagnosis_plan TEXT, ois_worker_self_care VARCHAR(1), ois_worker_comments TEXT,
ois_has_family_physician VARCHAR(1), ois_family_physician_name VARCHAR(50), ois_family_physician_phone_country VARCHAR(10), ois_family_physician_phone VARCHAR(24), ois_family_physician_plan TEXT, ois_family_physician_support VARCHAR(10), ois_family_physician_rtw_date DATE, ois_family_physician_treatment VARCHAR(10), ois_family_physician_modified VARCHAR(10), ois_family_physician_comments TEXT.

**C151S-specific:** rtw_status_changed VARCHAR(1) — gating question that makes entire expanded RTW section conditionally required.

All OIS columns are nullable in the database; form_id-based validation enforces presence/absence.

## FRD References
- Domain 4.2 Section 3.1.9: Return to Work fields (11 columns). Section 3.1.10: Invoice Correction fields (1 column).
- Domain 4.2 Appendix C: OIS-specific fields — grasping (12), zone lifting (6), directional reaching (4), environmental (8), assessment summary (~29). Total ~45 additional columns.

## Dependencies
This task depends on: D04W-003

## Tests
No specific unit tests for this task — verified by build/migration command.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter shared build
```
Fix any errors before finishing.

# D04W-045: Security: audit trail completeness for WCB operations

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

## What to Build
Create `apps/api/test/security/wcb/wcb.audit.security.ts`.

Verify that each WCB state change produces an audit record:

**Claim events:**
- WCB claim created -> wcb.claim_created with claim_id, form_id
- WCB claim updated -> wcb.claim_updated with changed fields
- WCB claim deleted -> wcb.claim_deleted with claim_id
- WCB claim validated -> wcb.claim_validated with passed/failed, error_count

**Batch events:**
- Batch generated -> wcb.batch_generated with batch_id, report_count
- Batch XSD validated -> wcb.batch_xsd_validated with passed/failed
- Batch downloaded -> wcb.batch_downloaded with batch_id, actor
- Batch upload confirmed -> wcb.batch_uploaded with batch_id, actor, timestamp

**Return/remittance events:**
- Return file processed -> wcb.return_processed with matched_count, error_count
- Remittance processed -> wcb.remittance_processed with record_count, total_payment

**MVP events:**
- MVP export generated -> wcb.mvp_export_generated with claim_id
- Manual outcome recorded -> wcb.manual_outcome_recorded with outcome_type

**Audit log integrity:**
- No UPDATE operations on audit_log for WCB entries
- No DELETE operations on audit_log for WCB entries
- Audit entries contain correct actor (physician_id or delegate_id)

## Dependencies
This task depends on: D04W-030, D04W-031

## Tests
No specific unit tests for this task — verified by build/migration command.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter api vitest run test/security/wcb/wcb.audit.security.ts
```
Fix any errors before finishing.

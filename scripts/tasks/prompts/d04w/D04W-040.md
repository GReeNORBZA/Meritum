# D04W-040: Security: authentication enforcement on every WCB route

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

## What to Build
Create `apps/api/test/security/wcb/wcb.authn.security.ts`.

Test every authenticated WCB route returns 401 without a valid session cookie:

- POST /api/v1/wcb/claims
- GET /api/v1/wcb/claims/:id
- PUT /api/v1/wcb/claims/:id
- DELETE /api/v1/wcb/claims/:id
- POST /api/v1/wcb/claims/:id/validate
- GET /api/v1/wcb/claims/:id/form-schema
- POST /api/v1/wcb/batches
- GET /api/v1/wcb/batches/:id
- GET /api/v1/wcb/batches/:id/download
- POST /api/v1/wcb/batches/:id/confirm-upload
- GET /api/v1/wcb/batches
- POST /api/v1/wcb/returns/upload
- GET /api/v1/wcb/returns/:batch_id
- POST /api/v1/wcb/remittances/upload
- GET /api/v1/wcb/remittances
- GET /api/v1/wcb/remittances/:id/discrepancies
- GET /api/v1/wcb/claims/:id/export
- POST /api/v1/wcb/claims/:id/manual-outcome

For each route: no cookie -> 401, expired cookie -> 401, tampered cookie -> 401.
All 401 responses must contain no data beyond the error object.

## Dependencies
This task depends on: D04W-030, D04W-031

## Security Requirements
- 18 WCB endpoints x 3 auth failure modes = 54 test cases.
- 401 responses must not leak any WCB claim data, batch info, or validation results.
- All queries touching PHI (patient data, claims, billing) MUST be scoped to the authenticated physician's tenant
- Never log PHN, patient names, or clinical data in plaintext
- PHN displayed as 123****** (first 3 + 6 asterisks)

## Tests
No specific unit tests for this task — verified by build/migration command.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter api vitest run test/security/wcb/wcb.authn.security.ts
```
Fix any errors before finishing.

# D04W-003: Drizzle schema for wcb_claim_details — employer, accident, injury assessment, treatment plan, and opioid fields

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

## What to Build
Add to `packages/shared/src/schemas/db/wcb.schema.ts` — additional columns on wcb_claim_details:

**Employer Fields (required for C050E/S, C151/S only):**

| Column | Type | Nullable | Notes |
|--------|------|----------|-------|
| employer_name | VARCHAR(50) | Yes | Required when form has Employer section |
| employer_location | VARCHAR(100) | Yes | |
| employer_city | VARCHAR(20) | Yes | |
| employer_province | VARCHAR(10) | Yes | |
| employer_phone_country | VARCHAR(10) | Yes | |
| employer_phone_number | VARCHAR(24) | Yes | |
| employer_phone_ext | VARCHAR(6) | Yes | |

**Accident Fields:**

| Column | Type | Nullable | Notes |
|--------|------|----------|-------|
| worker_job_title | VARCHAR(50) | Yes | Required for C050E/S, C151/S |
| injury_developed_over_time | VARCHAR(1) | Yes | Y/N. Required for C050E/S, C151/S, C568A |
| date_of_injury | DATE | No | Required for all forms |
| injury_description | TEXT | Yes | Max 1024 chars. Required for C050E/S, C151/S |

**Injury Assessment Fields (scalar — repeating entries in wcb_injuries):**

| Column | Type | Nullable | Notes |
|--------|------|----------|-------|
| date_of_examination | DATE | Yes | Required for forms with Injury section. Day 0 for timing |
| symptoms | TEXT | Yes | Max 2048. Required for C050E/S, C151/S |
| objective_findings | TEXT | Yes | Max 1024. Required for C050E/S, C151/S |
| current_diagnosis | TEXT | Yes | Max 1024. Required for C050E/S |
| previous_diagnosis | TEXT | Yes | Max 1024. Required for C151/S |
| diagnosis_changed | VARCHAR(1) | Yes | Y/N. C151/S only |
| diagnosis_changed_desc | TEXT | Yes | Max 1024. Required when diagnosis_changed = Y |
| diagnostic_code_1 | VARCHAR(8) | Yes | Primary ICD code. Required for Injury section forms |
| diagnostic_code_2 | VARCHAR(8) | Yes | Secondary |
| diagnostic_code_3 | VARCHAR(8) | Yes | Tertiary |
| additional_injuries_desc | TEXT | Yes | Max 1024. When >5 body parts |
| dominant_hand | VARCHAR(10) | Yes | L, R, AMB. Conditional on upper extremity injury |
| prior_conditions_flag | VARCHAR(1) | Yes | Y/N. Required for C050E/S, C151/S |
| prior_conditions_desc | TEXT | Yes | Max 1024. Required when flag = Y |
| referring_physician_name | VARCHAR(50) | Yes | C568, C568A only |
| date_of_referral | DATE | Yes | C568, C568A only |

**Treatment Plan Fields (scalar):**

| Column | Type | Nullable | Notes |
|--------|------|----------|-------|
| narcotics_prescribed | VARCHAR(1) | Yes | Y/N. Required for Treatment Plan forms. Triggers prescriptions and opioid fields |
| treatment_plan_text | TEXT | Yes | Max 1024. Required for C050E/S, C151/S |
| case_conf_wcb_manager | VARCHAR(1) | Yes | Y/N. C050E/S, C151/S |
| case_conf_wcb_physician | VARCHAR(1) | Yes | Y/N. C050E/S, C151/S |
| referral_rtw_provider | VARCHAR(1) | Yes | Y/N. C050E/S, C151/S |
| consultation_letter_format | VARCHAR(5) | Yes | ATTCH or TEXT. C568A |
| consultation_letter_text | TEXT | Yes | Required when format = TEXT |

**Opioid Management Fields (C151/C151S only — 23 columns):**

| Column | Type | Nullable | Notes |
|--------|------|----------|-------|
| surgery_past_60_days | VARCHAR(1) | Yes | Conditional: narcotics = Y on C151/S |
| treating_malignant_pain | VARCHAR(1) | Yes | |
| wcb_advised_no_mmr | VARCHAR(1) | Yes | |
| side_effect_nausea | VARCHAR(1) | Yes | 13 side-effect Y/N fields |
| side_effect_sleep | VARCHAR(1) | Yes | |
| side_effect_constipation | VARCHAR(1) | Yes | |
| side_effect_endocrine | VARCHAR(1) | Yes | |
| side_effect_sweating | VARCHAR(1) | Yes | |
| side_effect_cognitive | VARCHAR(1) | Yes | |
| side_effect_dry_mouth | VARCHAR(1) | Yes | |
| side_effect_fatigue | VARCHAR(1) | Yes | |
| side_effect_depression | VARCHAR(1) | Yes | |
| side_effect_worsening_pain | VARCHAR(1) | Yes | |
| abuse_social_deterioration | VARCHAR(1) | Yes | 6 abuse-indicator Y/N fields |
| abuse_unsanctioned_use | VARCHAR(1) | Yes | |
| abuse_altered_route | VARCHAR(1) | Yes | |
| abuse_opioid_seeking | VARCHAR(1) | Yes | |
| abuse_other_sources | VARCHAR(1) | Yes | |
| abuse_withdrawal | VARCHAR(1) | Yes | |
| patient_pain_estimate | SMALLINT | Yes | 0-10 scale |
| opioid_reducing_pain | VARCHAR(1) | Yes | Y/N |
| pain_reduction_desc | TEXT | Yes | Max 2048. Required when opioid_reducing_pain = Y |
| clinician_function_estimate | SMALLINT | Yes | 0-10 scale |

## FRD References
- Domain 4.2 Section 3.1.4: Employer fields (7 columns). Section 3.1.5: Accident fields (4 columns). Section 3.1.6: Injury assessment scalar fields (16 columns).
- Domain 4.2 Section 3.1.7: Treatment plan scalar fields (7 columns). Section 3.1.8: Opioid management fields (23 columns, C151/S only).

## Dependencies
This task depends on: D04W-002

## Tests
No specific unit tests for this task — verified by build/migration command.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter shared build
```
Fix any errors before finishing.

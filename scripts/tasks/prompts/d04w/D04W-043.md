# D04W-043: Security: input validation and injection prevention for WCB endpoints

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

## What to Build
Create `apps/api/test/security/wcb/wcb.input.security.ts`.

**SQL injection payloads on string inputs:**
- patient_first_name: `' OR 1=1--`
- employer_name: `'; DROP TABLE wcb_claim_details;--`
- injury_description: SQL injection payloads
- additional_comments: SQL injection payloads

**XSS payloads on stored text fields:**
- treatment_plan_text: `<script>alert(1)</script>`
- objective_findings: `<img onerror=alert(1) src=x>`
- consultation_letter_text: XSS payloads

**Type coercion attacks:**
- Send number where string expected for form_id
- Send array where string expected for wcb_claim_number
- Send null where required field expected
- Send negative ordinal for injury entry
- Send ordinal > 5 for injury entry
- Send invoice_detail_id > 25

**UUID parameter validation:**
- Non-UUID in /wcb/claims/not-a-uuid -> 400
- Non-UUID in /wcb/batches/not-a-uuid -> 400

**WCB-specific validation attacks:**
- form_id with invalid value (e.g., 'C999') -> 400
- patient_phn with 8 digits (below 9) -> validation error
- patient_phn with letters -> validation error
- Attachment file_content_b64 with invalid base64 -> 400
- Return file upload with binary content (not tab-delimited) -> 400
- Remittance upload with invalid XML -> 400

**Boundary values:**
- Additional_comments at exactly 2048 chars -> accepted
- Additional_comments at 2049 chars -> rejected
- Patient_first_name at 11 chars -> accepted
- Patient_first_name at 12 chars -> rejected

## Dependencies
This task depends on: D04W-030, D04W-031

## Tests
No specific unit tests for this task — verified by build/migration command.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter api vitest run test/security/wcb/wcb.input.security.ts
```
Fix any errors before finishing.

# D04W-041: Security: authorization and role/permission enforcement for WCB routes

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

## What to Build
Create `apps/api/test/security/wcb/wcb.authz.security.ts`.

**Permission enforcement:**
- POST /wcb/claims without CLAIM_CREATE -> 403
- GET /wcb/claims/:id without CLAIM_VIEW -> 403
- PUT /wcb/claims/:id without CLAIM_EDIT -> 403
- DELETE /wcb/claims/:id without CLAIM_DELETE -> 403
- POST /wcb/batches without BATCH_APPROVE -> 403
- GET /wcb/batches/:id/download without WCB_BATCH_UPLOAD -> 403

**Delegate permission boundary:**
- Delegate with CLAIM_VIEW only -> cannot POST /wcb/claims (no CLAIM_CREATE) -> 403
- Delegate with CLAIM_VIEW + CLAIM_CREATE -> can create WCB claims
- Delegate without BATCH_APPROVE -> cannot create batches
- Delegate without BATCH_VIEW -> cannot view batch details

**Contract/Role validation as authz:**
- Physician with Contract 000001/GP attempts to create C050S (requires 000053/OIS) -> rejected at validation, not 403 (business rule, not authz)

**Upload permission:**
- Delegate without WCB_BATCH_UPLOAD -> cannot download batch or confirm upload

## Dependencies
This task depends on: D04W-030, D04W-031

## Tests
No specific unit tests for this task — verified by build/migration command.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter api vitest run test/security/wcb/wcb.authz.security.ts
```
Fix any errors before finishing.

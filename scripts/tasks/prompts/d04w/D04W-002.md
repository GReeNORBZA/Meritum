# D04W-002: Drizzle schema for wcb_claim_details table — general, practitioner, and claimant fields

## Project Context
You are building **Meritum Health Technologies**, a self-serve medical billing platform for Alberta physicians (AHCIP + WCB claims). This is a monorepo with:
- `apps/api` — Fastify 5 REST API with Drizzle ORM, PostgreSQL 16
- `apps/web` — Next.js 15 frontend
- `packages/shared` — Shared Drizzle schemas, Zod validators, constants, utilities

Tech stack: TypeScript, Fastify 5, Drizzle ORM, PostgreSQL 16, Vitest + Supertest, Lucia auth.

## What to Build
Create `packages/shared/src/schemas/db/wcb.schema.ts` starting with the wcb_claim_details table (first portion).

**wcb_claim_details table — General Fields:**

| Column | Type | Nullable | Notes |
|--------|------|----------|-------|
| wcb_claim_detail_id | UUID | No | PK, gen_random_uuid() |
| claim_id | UUID FK | No | FK -> claims.claim_id (Domain 4.0) |
| form_id | VARCHAR(5) | No | C050E, C050S, C151, C151S, C568, C568A, C569, C570 |
| submitter_txn_id | VARCHAR(16) | No | Unique. First 2 chars = vendor prefix |
| wcb_claim_number | VARCHAR(7) | Yes | WCB-assigned 7-digit claim number |
| report_completion_date | DATE | No | Date physician completed report |
| additional_comments | TEXT | Yes | Max 2048 chars |
| parent_wcb_claim_id | UUID FK | Yes | FK -> wcb_claim_details for follow-up chain |

**Practitioner Fields (immutable snapshot at claim creation):**

| Column | Type | Nullable | Notes |
|--------|------|----------|-------|
| practitioner_billing_number | VARCHAR(8) | No | AH billing number |
| contract_id | VARCHAR(10) | No | WCB Contract ID (e.g., 000001) |
| role_code | VARCHAR(10) | No | GP, SP, ERS, ANE, OR, DP, VSC, VSCFAC, OIS, NP, HP |
| practitioner_first_name | VARCHAR(11) | No | Max 11 chars per WCB spec |
| practitioner_middle_name | VARCHAR(11) | Yes | |
| practitioner_last_name | VARCHAR(21) | No | Max 21 chars per WCB spec |
| skill_code | VARCHAR(10) | No | 141 valid values |
| facility_type | VARCHAR(1) | No | C, F, or H |
| clinic_reference_number | VARCHAR(8) | Yes | |
| billing_contact_name | VARCHAR(30) | Yes | |
| fax_country_code | VARCHAR(10) | Yes | |
| fax_number | VARCHAR(24) | Yes | |

**Claimant (Patient) Fields (immutable snapshot):**

| Column | Type | Nullable | Notes |
|--------|------|----------|-------|
| patient_no_phn_flag | VARCHAR(1) | No | Y/N |
| patient_phn | VARCHAR(9) | Yes | 9 digits. Required when no_phn_flag = N |
| patient_gender | VARCHAR(1) | No | M, F, U |
| patient_first_name | VARCHAR(11) | No | Max 11 chars |
| patient_middle_name | VARCHAR(11) | Yes | |
| patient_last_name | VARCHAR(21) | No | Max 21 chars |
| patient_dob | DATE | No | |
| patient_address_line1 | VARCHAR(30) | No | |
| patient_address_line2 | VARCHAR(30) | Yes | |
| patient_city | VARCHAR(20) | No | |
| patient_province | VARCHAR(10) | Yes | |
| patient_postal_code | VARCHAR(9) | Yes | |
| patient_phone_country | VARCHAR(10) | Yes | |
| patient_phone_number | VARCHAR(24) | Yes | |

**Indexes:** UNIQUE on submitter_txn_id, index on claim_id (FK), index on (form_id, wcb_claim_number), index on parent_wcb_claim_id.

Add standard timestamps: created_at, updated_at, deleted_at (soft delete), created_by (UUID FK), updated_by (UUID FK).

Export table and inferred types (InsertWcbClaimDetail, SelectWcbClaimDetail).

## FRD References
- Domain 4.2 Section 3.1.1: General fields. Section 3.1.2: Practitioner fields (snapshot from Provider Management). Section 3.1.3: Claimant fields (snapshot from Patient Registry).

## Dependencies
This task depends on: D04W-001

## Security Requirements
- Patient PHN is PHI — stored encrypted or protected by column-level access. Never logged in plaintext.
- Practitioner and patient fields are immutable snapshots: values at time of claim creation, not live references. This ensures submitted data integrity.
- All queries touching PHI (patient data, claims, billing) MUST be scoped to the authenticated physician's tenant
- Never log PHN, patient names, or clinical data in plaintext
- PHN displayed as 123****** (first 3 + 6 asterisks)

## Tests
No specific unit tests for this task — verified by build/migration command.

## Run After Completion
After completing your changes, run:
```bash
pnpm --filter shared build
```
Fix any errors before finishing.

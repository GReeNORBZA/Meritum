# D11-032 — Routes: Guided Tour, Patient Import, BA Status Confirmation

**Task ID:** D11-032
**Domain:** 11 — Onboarding
**Section:** Routes & Integration Tests
**Depends on:** D11-022, D11-030
**Verify:** `pnpm --filter api vitest run test/integration/onboarding/`

---

## Build Instructions

Add to `apps/api/src/domains/onboarding/onboarding.routes.ts` the supplementary endpoints.

### Routes

| Method | Path | Auth | Description |
|--------|------|------|-------------|
| POST | /api/v1/onboarding/guided-tour/complete | Physician | Mark guided tour completed |
| POST | /api/v1/onboarding/guided-tour/dismiss | Physician | Mark guided tour dismissed |
| POST | /api/v1/onboarding/patient-import/complete | Physician | Mark patient import completed during onboarding |
| POST | /api/v1/onboarding/ba/:ba_id/confirm-active | Physician | Manually confirm BA is active with Alberta Health |

### Handler Details

All handlers are thin wrappers calling corresponding service methods. Each returns updated progress.

**POST /guided-tour/complete** — Call `completeGuidedTour(providerId)`. Return updated progress.

**POST /guided-tour/dismiss** — Call `dismissGuidedTour(providerId)`. Return updated progress.

**POST /patient-import/complete** — Call `completePatientImport(providerId)`. Return updated progress.

**POST /ba/:ba_id/confirm-active** — Validate `ba_id` is a valid UUID. Call `confirmBaActive(providerId, baId)`. Return updated BA status.

### Integration Tests

Create `apps/api/test/integration/onboarding/onboarding-supplementary.integration.ts`.

---

## FRD References

- **Domain 11 Section 6:** Guided tour complete/dismiss endpoints.
- **Domain 11 Section 5:** Patient import completion tracking during onboarding.
- **Domain 11 Section 4.2:** BA status manual confirmation from PENDING to ACTIVE.

---

## Test Specifications

Create `apps/api/test/integration/onboarding/onboarding-supplementary.integration.ts`:

1. POST /guided-tour/complete marks tour completed
2. POST /guided-tour/complete is idempotent
3. POST /guided-tour/dismiss marks tour dismissed
4. POST /patient-import/complete marks import completed
5. POST /ba/:ba_id/confirm-active updates BA to ACTIVE
6. POST /ba/:ba_id/confirm-active with non-PENDING BA returns 400
7. POST /ba/:ba_id/confirm-active with other physician's BA returns 404

---

## Codebase Context

- **Module location:** `apps/api/src/domains/onboarding/onboarding.routes.ts` (same file as D11-030, D11-031)
- **UUID validation:** Validate `ba_id` path parameter as UUID format before passing to service.
- **Cross-physician isolation:** BA confirmation must return 404 (not 403) when the BA belongs to another physician — do not confirm resource existence.
- **Integration test location:** `apps/api/test/integration/onboarding/`
- **Existing pattern:** Follow the same integration test setup pattern as used in D11-030 tests.

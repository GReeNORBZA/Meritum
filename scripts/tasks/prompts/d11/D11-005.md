# D11-005 — Generate and Apply Database Migration for Onboarding Tables

**Task ID:** D11-005
**Domain:** 11 — Onboarding
**Section:** Shared Types & Constants
**Depends on:** D11-002, D11-003
**Verify:** `cd apps/api && pnpm drizzle-kit generate 2>&1 && pnpm drizzle-kit migrate 2>&1`

---

## Build Instructions

Run the Drizzle migration generator for the onboarding tables:

```bash
cd apps/api
pnpm drizzle-kit generate
pnpm drizzle-kit migrate
```

### Verification Checklist

1. Verify that the migration file was created in `apps/api/drizzle/migrations/`.
2. Verify that both tables exist in the test database:
   - `onboarding_progress`
   - `ima_records`
3. Verify all indexes and constraints are applied:
   - Unique index on `onboarding_progress.provider_id`
   - Composite index on `ima_records(provider_id, acknowledged_at DESC)`
4. Verify FK references to the `providers` table resolve correctly.

---

## Codebase Context

- **Migration location:** `apps/api/drizzle/migrations/`
- **Drizzle config:** Check `apps/api/drizzle.config.ts` for database connection and migration settings.
- **DB:** PostgreSQL via Drizzle ORM
- **Prerequisite:** The Drizzle schema files from D11-002 and D11-003 must be complete and the shared package must build successfully before running migration generation.
- **Existing pattern:** Check existing migrations in `apps/api/drizzle/migrations/` for naming conventions and structure.

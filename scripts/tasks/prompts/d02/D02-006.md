# Task D02-006: Drizzle schema for statutory_holidays, explanatory_codes, and reference_data_staging tables

## What to Build

Add to `packages/shared/src/schemas/db/reference.schema.ts`:

**statutory_holidays table (not versioned -- date-specific):**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| holiday_id | UUID | PK | Default: gen_random_uuid() |
| date | DATE | NOT NULL, UNIQUE | Holiday date (one per date) |
| name | VARCHAR(100) | NOT NULL | Holiday name (e.g., "Family Day") |
| jurisdiction | VARCHAR(20) | NOT NULL | provincial, federal, both |
| affects_billing_premiums | BOOLEAN | NOT NULL, DEFAULT true | Whether billing premiums apply |
| year | INTEGER | NOT NULL | Extracted year for indexing |

**Indexes:** unique on date, (year).

Note: statutory_holidays is NOT versioned -- it is date-specific. No version_id or effective_from/effective_to columns.

**explanatory_codes table (~100-200 records):**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| id | UUID | PK | Default: gen_random_uuid() |
| expl_code | VARCHAR(10) | NOT NULL | Explanatory code |
| description | TEXT | NOT NULL | Official description |
| severity | VARCHAR(10) | NOT NULL | paid, adjusted, rejected |
| common_cause | TEXT | NULLABLE | Meritum-authored common cause explanation |
| suggested_action | TEXT | NULLABLE | Meritum-authored suggested action |
| help_text | TEXT | NULLABLE | User-facing contextual help |
| version_id | UUID FK | NOT NULL, FK -> reference_data_versions | Parent version |
| effective_from | DATE | NOT NULL | Denormalised from version |
| effective_to | DATE | NULLABLE | Denormalised from version |

**Indexes:** (expl_code, version_id).

**reference_data_staging table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| staging_id | UUID | PK | Default: gen_random_uuid() |
| data_set | VARCHAR(30) | NOT NULL | Which data set is being staged |
| status | VARCHAR(20) | NOT NULL, DEFAULT 'uploaded' | uploaded, validated, diff_generated, published, discarded |
| uploaded_by | UUID FK | NOT NULL, FK -> users | Admin who uploaded |
| uploaded_at | TIMESTAMPTZ | NOT NULL | Upload timestamp |
| file_hash | VARCHAR(64) | NOT NULL | SHA-256 hash of uploaded file |
| record_count | INTEGER | NOT NULL | Number of records in staged data |
| validation_result | JSONB | NULLABLE | Validation errors/warnings |
| diff_result | JSONB | NULLABLE | Diff against active version |
| staged_data | JSONB | NOT NULL | The parsed records (full data) |
| created_at | TIMESTAMPTZ | NOT NULL | Record creation timestamp |

**Indexes:** (data_set, status).

Use Drizzle ORM's `pgTable`. Follow the same patterns used in existing tables in this schema file.

Export all tables and inferred types (InsertStatutoryHoliday, SelectStatutoryHoliday, InsertExplanatoryCode, SelectExplanatoryCode, InsertReferenceDataStaging, SelectReferenceDataStaging).

## Prerequisites

- D02-002 must be complete (reference_data_versions table exists for FK reference).
- User schema must exist for the FK reference on uploaded_by.

## FRD Reference

- Domain 2 Section 2.9: Statutory holidays -- 11 Alberta holidays. Not versioned, date-specific.
- Domain 2 Section 2.10: Explanatory codes with severity, common cause, suggested action.
- Domain 2 Section 6.2: Staging workflow -- data uploaded to staging, validated, diff generated, then published or discarded.

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

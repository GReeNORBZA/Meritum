# Task D02-004: Drizzle schema for governing_rules and functional_centres tables

## What to Build

Add to `packages/shared/src/schemas/db/reference.schema.ts`:

**governing_rules table (~50-80 rules):**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| id | UUID | PK | Default: gen_random_uuid() |
| rule_id | VARCHAR(20) | NOT NULL | e.g., GR3, GR5_3b, SURCHG_1399H |
| rule_name | VARCHAR(200) | NOT NULL | Human-readable rule name |
| rule_category | VARCHAR(30) | NOT NULL | visit_limits, code_combinations, modifier_rules, referral_rules, facility_rules, surcharge_rules, time_rules, general |
| description | TEXT | NOT NULL | Full rule description |
| rule_logic | JSONB | NOT NULL | Machine-readable rule definition. Strict schema per rule_category. |
| severity | VARCHAR(10) | NOT NULL | error, warning, info |
| error_message | TEXT | NOT NULL | User-facing error message when rule is violated |
| help_text | TEXT | NULLABLE | User-facing contextual help |
| source_reference | VARCHAR(100) | NULLABLE | Reference to source regulation |
| source_url | TEXT | NULLABLE | URL to source document |
| version_id | UUID FK | NOT NULL, FK -> reference_data_versions | Parent version |
| effective_from | DATE | NOT NULL | Denormalised from version |
| effective_to | DATE | NULLABLE | Denormalised from version |

**Indexes:** (rule_id, version_id), (rule_category, version_id).

**functional_centres table (~2,000-3,000 records):**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| id | UUID | PK | Default: gen_random_uuid() |
| code | VARCHAR(10) | NOT NULL | Functional centre code |
| name | VARCHAR(200) | NOT NULL | Facility name |
| facility_type | VARCHAR(30) | NOT NULL | office, hospital_inpatient, hospital_outpatient, emergency, auxiliary_hospital, nursing_home, telehealth, community_health, other |
| location_city | VARCHAR(100) | NULLABLE | City |
| location_region | VARCHAR(50) | NULLABLE | Region/zone |
| rrnp_community_id | UUID | NULLABLE, FK -> rrnp_communities | Link to RRNP community (defined in D02-005) |
| active | BOOLEAN | NOT NULL, DEFAULT true | Whether centre is active |
| version_id | UUID FK | NOT NULL, FK -> reference_data_versions | Parent version |
| effective_from | DATE | NOT NULL | Denormalised from version |
| effective_to | DATE | NULLABLE | Denormalised from version |

**Indexes:** (code, version_id), (facility_type, version_id).

Note: The rrnp_community_id FK references rrnp_communities which is defined in D02-005. You may need to use a deferred FK or define the reference after both tables exist. Follow the Drizzle ORM pattern for forward references.

Use Drizzle ORM's `pgTable`. Follow the same patterns used in existing tables in this schema file.

Export all tables and inferred types (InsertGoverningRule, SelectGoverningRule, InsertFunctionalCentre, SelectFunctionalCentre).

## Prerequisites

- D02-002 must be complete (reference_data_versions table exists for FK reference).

## FRD Reference

- Domain 2 Section 2.4: Governing rules with 12 fields. ~50-80 rules across GR 1-13 + surcharge rules. Rule_logic JSONB follows strict schema per rule_category.
- Domain 2 Section 2.5: Functional centres with 10 fields. ~2,000-3,000 codes.

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

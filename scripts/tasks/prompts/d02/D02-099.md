# Task D02-099: Full domain test suite â€” all unit + integration + security tests

## What to Build

Run the complete test suite for Domain 2 Reference Data. Do NOT write new code unless tests fail.

1. Run all unit tests:
```bash
pnpm --filter api vitest run src/domains/reference/
```

2. Run all integration tests:
```bash
pnpm --filter api vitest run test/integration/reference/
```

3. Run all security tests:
```bash
pnpm --filter api vitest run test/security/reference/
```

If any tests fail: read the failure output, diagnose the root cause, fix the source code (not the tests unless the test itself is incorrect), and re-run the failing test file.

After all individual suites pass, run the full suite one final time:
```bash
pnpm --filter api vitest run src/domains/reference/ test/integration/reference/ test/security/reference/
```

**Verify these security test files exist and are non-empty:**
- `apps/api/test/security/reference/reference.authn.security.ts`
- `apps/api/test/security/reference/reference.authz.security.ts`
- `apps/api/test/security/reference/reference.scoping.security.ts`
- `apps/api/test/security/reference/reference.input.security.ts`
- `apps/api/test/security/reference/reference.leakage.security.ts`
- `apps/api/test/security/reference/reference.audit.security.ts`

**Verify these source files exist:**
- `packages/shared/src/constants/reference.constants.ts`
- `packages/shared/src/schemas/db/reference.schema.ts`
- `packages/shared/src/schemas/reference.schema.ts`
- `apps/api/src/domains/reference/reference.repository.ts`
- `apps/api/src/domains/reference/reference.service.ts`
- `apps/api/src/domains/reference/reference.routes.ts`
- `apps/api/src/domains/reference/reference.handlers.ts`

**Verify these integration test files exist:**
- `apps/api/test/integration/reference/search.integration.ts`
- `apps/api/test/integration/reference/admin.integration.ts`
- `apps/api/test/integration/reference/validation.integration.ts`
- `apps/api/test/integration/reference/changes.integration.ts`

If any file is missing, investigate which prior task failed to create it and report the issue.

## Critical Security Rules

- All 6 security test files must exist and pass.
- No test should be skipped or commented out.
- Security tests must not be weakened to make them pass -- fix the source code instead.

## Prerequisites

- All previous Domain 2 tasks must be complete:
  - D02-040 through D02-045 (all security tests).
  - D02-030 through D02-032 (all routes and integration tests).
  - D02-020 through D02-024 (all service layer tasks).
  - D02-010 through D02-013 (all repository tasks).
  - D02-001 through D02-009 (all shared types, schemas, and migration).

## Run After Completion

```bash
pnpm --filter api vitest run src/domains/reference/ test/integration/reference/ test/security/reference/
```

All tests must pass before outputting [TASK_COMPLETE].

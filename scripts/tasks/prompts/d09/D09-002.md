# Task D09-002: Drizzle schema for notifications table

## What to Build

Create `packages/shared/src/schemas/db/notification.schema.ts` with the notifications table.

**notifications table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| notification_id | UUID | PK | Default: gen_random_uuid() |
| recipient_id | UUID FK | NOT NULL, FK -> users | Physician or delegate |
| physician_context_id | UUID FK | NULLABLE, FK -> providers | For delegate notifications: which physician context. Null for system-wide. |
| event_type | VARCHAR(50) | NOT NULL | Event type from catalogue (e.g., 'CLAIM_REJECTED') |
| priority | VARCHAR(10) | NOT NULL | URGENT, HIGH, MEDIUM, LOW |
| title | VARCHAR(200) | NOT NULL | Rendered from template |
| body | TEXT | NOT NULL | Rendered from template |
| action_url | VARCHAR(500) | NULLABLE | URL to navigate on click |
| action_label | VARCHAR(50) | NULLABLE | Button label (e.g., 'View Claim') |
| metadata | JSONB | NULLABLE | Event-specific data: claim_id, batch_id, etc. |
| channels_delivered | JSONB | NOT NULL | { in_app: boolean, email: boolean, push: boolean } |
| read_at | TIMESTAMPTZ | NULLABLE | When read in-app. Null if unread. |
| dismissed_at | TIMESTAMPTZ | NULLABLE | When dismissed (hidden from feed, retained for audit). |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |

**Indexes:** (recipient_id, read_at) for unread count, (recipient_id, created_at DESC) for feed, (event_type, created_at) for analytics.

Export table and inferred types (InsertNotification, SelectNotification).

Use Drizzle ORM's `pgTable` with `uuid`, `varchar`, `text`, `jsonb`, `timestamp` column types. Follow the same patterns used in existing schemas (e.g., `packages/shared/src/schemas/db/user.schema.ts`).

## Critical Security Rules

- All notification queries must be scoped by recipient_id -- no cross-user notification access.
- The physician_context_id column enables delegate notification scoping -- delegates only see notifications from their linked physician contexts.
- Dismissed notifications are retained for audit trail (soft-hide via dismissed_at, not hard delete).

## Prerequisites

- D09-001 must be complete (notification constants for event_type and priority values).
- The `packages/shared/src/schemas/db/` directory must exist (created by Domain 1).
- User schema must exist for the FK reference to users table.

## FRD Reference

- Domain 9 Section 5.1: notifications table with all columns, indexes, and 90-day retention.

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

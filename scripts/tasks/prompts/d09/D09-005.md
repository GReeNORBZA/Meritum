# Task D09-005: Zod validation schemas for notification feed, preferences, and event ingestion endpoints

## What to Build

Create `packages/shared/src/schemas/notification.schema.ts` with Zod schemas:

**Notification feed:**
- notificationFeedQuerySchema: { unread_only: boolean().optional().default(false), limit: number().int().min(1).max(100).default(20), offset: number().int().min(0).default(0) }
- notificationIdParamSchema: { id: string().uuid() }

**Preferences:**
- updatePreferenceSchema: { in_app_enabled: boolean().optional(), email_enabled: boolean().optional(), digest_mode: enum(['IMMEDIATE', 'DAILY_DIGEST', 'WEEKLY_DIGEST']).optional() }
- preferenceCategoryParamSchema: { category: string().min(1).max(50) }
- quietHoursSchema: { quiet_hours_start: string().regex(/^\d{2}:\d{2}$/).nullable(), quiet_hours_end: string().regex(/^\d{2}:\d{2}$/).nullable() }
- Refinement: if quiet_hours_start is set, quiet_hours_end is required and vice versa. Both null to clear.

**Internal event ingestion:**
- emitEventSchema: { event_type: string().min(1).max(50), physician_id: string().uuid(), metadata: record(string(), unknown()).optional() }
- emitBatchEventSchema: { events: array(emitEventSchema).min(1).max(500) }

**Response schemas:**
- notificationResponseSchema: notification object with all public fields (notification_id, event_type, priority, title, body, action_url, action_label, metadata, channels_delivered, read_at, dismissed_at, created_at)
- unreadCountResponseSchema: { count: number().int().min(0) }
- preferenceResponseSchema: preference object (preference_id, event_category, in_app_enabled, email_enabled, digest_mode, quiet_hours_start, quiet_hours_end)

Export all schemas and inferred types using `z.infer<typeof schemaName>`.

## Critical Security Rules

- Validation schemas must enforce strict types to prevent injection attacks.
- UUID validation on all ID parameters to prevent SQL injection via path params.
- The quiet hours refinement ensures atomic updates (both start and end, or both null).
- emitBatchEventSchema limits to 500 events max to prevent abuse of the batch endpoint.

## Prerequisites

- D09-001 must be complete (notification constants for enum values used in schemas).

## FRD Reference

- Domain 9 Section 8.1: Notification feed params -- unread_only, limit, offset. Ordered by created_at DESC.
- Domain 9 Section 8.2: Preference endpoints -- per-category update, quiet hours set.
- Domain 9 Section 8.3: Internal emit endpoint -- event_type, physician_id, metadata.

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

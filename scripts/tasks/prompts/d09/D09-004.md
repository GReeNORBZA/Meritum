# Task D09-004: Drizzle schema for digest_queue and notification_preferences tables

## What to Build

Add to `packages/shared/src/schemas/db/notification.schema.ts`:

**digest_queue table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| queue_id | UUID | PK | Default: gen_random_uuid() |
| recipient_id | UUID FK | NOT NULL, FK -> users | |
| notification_id | UUID FK | NOT NULL, FK -> notifications | Already created with in-app delivery |
| digest_type | VARCHAR(20) | NOT NULL | DAILY or WEEKLY |
| digest_sent | BOOLEAN | NOT NULL, DEFAULT false | Whether included in a digest email |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |

**Indexes:** (recipient_id, digest_sent, digest_type) for digest assembly, (created_at) for cleanup.

**notification_preferences table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| preference_id | UUID | PK | Default: gen_random_uuid() |
| provider_id | UUID FK | NOT NULL, FK -> providers | |
| event_category | VARCHAR(50) | NOT NULL | e.g., 'claim_rejection', 'deadline_approaching' |
| in_app_enabled | BOOLEAN | NOT NULL, DEFAULT true | Cannot be disabled for URGENT events |
| email_enabled | BOOLEAN | NOT NULL | Default per event catalogue |
| digest_mode | VARCHAR(20) | NOT NULL, DEFAULT 'IMMEDIATE' | IMMEDIATE, DAILY_DIGEST, WEEKLY_DIGEST |
| quiet_hours_start | TIME | NULLABLE | Start of quiet hours (global, not per-category) |
| quiet_hours_end | TIME | NULLABLE | End of quiet hours |
| updated_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |

**Constraints:** UNIQUE(provider_id, event_category).
**Indexes:** (provider_id) for loading all preferences.

Export tables and inferred types (InsertDigestQueueItem, SelectDigestQueueItem, InsertNotificationPreference, SelectNotificationPreference).

## Critical Security Rules

- Preferences are scoped to provider_id -- no cross-physician preference access.
- createDefaultPreferences must enforce that URGENT in-app cannot be disabled.
- Quiet hours apply globally per provider, not per event category.

## Prerequisites

- D09-002 must be complete (notifications table must exist for FK references from digest_queue).
- Provider schema must exist for FK reference from notification_preferences.

## FRD Reference

- Domain 9 Section 4.1: notification_preferences table -- per-category channel and frequency config. URGENT in-app cannot be disabled.
- Domain 9 Section 5.4: digest_queue holds notifications awaiting digest assembly.

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

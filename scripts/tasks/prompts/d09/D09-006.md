# Task D09-006: Generate and apply database migration for notification tables

## What to Build

Run the Drizzle migration generator for the notification tables:

```bash
cd apps/api
pnpm drizzle-kit generate
pnpm drizzle-kit migrate
```

Verify that the migration file was created in `apps/api/drizzle/migrations/`.
Verify that all 5 tables exist: notifications, email_delivery_log, notification_templates, digest_queue, notification_preferences.
Verify all indexes, constraints, and FK references resolve correctly.

After running the migration, check the generated SQL to ensure:
1. All foreign keys reference the correct tables (users, providers, notifications).
2. All indexes are created as specified in the schema tasks (D09-002, D09-003, D09-004).
3. The UNIQUE constraint on (provider_id, event_category) in notification_preferences is present.
4. All default values are set correctly (gen_random_uuid() for UUIDs, now() for timestamps, etc.).

If any migration issues occur, review the schema files in `packages/shared/src/schemas/db/notification.schema.ts` and fix any problems before re-running the migration.

## Critical Security Rules

- Foreign key constraints ensure referential integrity -- notifications cannot reference non-existent users or providers.
- The UNIQUE constraint on notification_preferences prevents duplicate preference entries per provider/category.
- Migration files are append-only in production -- never modify existing migration files.

## Prerequisites

- D09-002 must be complete (notifications table schema).
- D09-003 must be complete (email_delivery_log and notification_templates schemas).
- D09-004 must be complete (digest_queue and notification_preferences schemas).
- Database must be running and accessible.

## Run After Completion

```bash
cd apps/api && pnpm drizzle-kit generate 2>&1 && pnpm drizzle-kit migrate 2>&1
```

All tests must pass before outputting [TASK_COMPLETE].

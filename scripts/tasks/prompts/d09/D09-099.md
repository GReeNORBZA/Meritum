# Task D09-099: Full domain test suite â€” all unit + integration + security tests

## What to Build

Run the complete test suite for Domain 9 Notification Service. Do NOT write new code unless tests fail.

1. Run all unit tests:
```bash
pnpm --filter api vitest run src/domains/notification/
```

2. Run all integration tests:
```bash
pnpm --filter api vitest run test/integration/notification/
```

3. Run all security tests:
```bash
pnpm --filter api vitest run test/security/notification/
```

If any tests fail: read the failure output, diagnose the root cause, fix the source code (not the tests unless the test itself is incorrect), and re-run the failing test file.

After all individual suites pass, run the full suite one final time:
```bash
pnpm --filter api vitest run src/domains/notification/ test/integration/notification/ test/security/notification/
```

**Verify these security test files exist and are non-empty:**
- `apps/api/test/security/notification/notification.authn.security.ts`
- `apps/api/test/security/notification/notification.authz.security.ts`
- `apps/api/test/security/notification/notification.scoping.security.ts`
- `apps/api/test/security/notification/notification.input.security.ts`
- `apps/api/test/security/notification/notification.leakage.security.ts`
- `apps/api/test/security/notification/notification.audit.security.ts`

**Verify these source files exist:**
- `packages/shared/src/constants/notification.constants.ts`
- `packages/shared/src/schemas/db/notification.schema.ts`
- `packages/shared/src/schemas/notification.schema.ts`
- `apps/api/src/domains/notification/notification.repository.ts`
- `apps/api/src/domains/notification/notification.service.ts`
- `apps/api/src/domains/notification/notification.routes.ts`
- `apps/api/src/domains/notification/notification.handlers.ts`

**Verify these integration test files exist:**
- `apps/api/test/integration/notification/notification-feed.integration.ts`
- `apps/api/test/integration/notification/notification-preferences.integration.ts`
- `apps/api/test/integration/notification/notification-internal.integration.ts`

If any file is missing, investigate which prior task failed to create it and report the issue.

## Critical Security Rules

- All 6 security test files must exist and pass.
- No test should be skipped or commented out.
- Security tests must not be weakened to make them pass -- fix the source code instead.

## Prerequisites

- All previous Domain 9 tasks must be complete:
  - D09-040 through D09-045 (all security tests).
  - D09-030 through D09-032 (all routes and integration tests).
  - D09-020 through D09-023 (all service layer tasks).
  - D09-010 through D09-012 (all repository tasks).
  - D09-001 through D09-006 (all shared types, schemas, and migration).

## Run After Completion

```bash
pnpm --filter api vitest run src/domains/notification/ test/integration/notification/ test/security/notification/
```

All tests must pass before outputting [TASK_COMPLETE].

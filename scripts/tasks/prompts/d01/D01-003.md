# Task D01-003: Drizzle schema for recovery_codes, sessions, invitation_tokens tables

## What to Build

Add to `packages/shared/src/schemas/db/iam.schema.ts`:

**recovery_codes table:**

| Column | Type | Constraints |
|--------|------|-------------|
| code_id | UUID | PK |
| user_id | UUID FK | NOT NULL, FK → users |
| code_hash | VARCHAR(255) | NOT NULL (Argon2id hash) |
| used | BOOLEAN | NOT NULL, DEFAULT false |
| created_at | TIMESTAMPTZ | NOT NULL |

Index: (user_id, used) for finding unused codes.

**sessions table:**

| Column | Type | Constraints |
|--------|------|-------------|
| session_id | UUID | PK |
| user_id | UUID FK | NOT NULL, FK → users |
| token_hash | VARCHAR(255) | NOT NULL, UNIQUE |
| ip_address | VARCHAR(45) | NOT NULL |
| user_agent | TEXT | NOT NULL |
| created_at | TIMESTAMPTZ | NOT NULL |
| last_active_at | TIMESTAMPTZ | NOT NULL |
| revoked | BOOLEAN | NOT NULL, DEFAULT false |
| revoked_reason | VARCHAR(30) | NULLABLE |

Indexes: unique on token_hash, (user_id, revoked) for active sessions, (last_active_at) for cleanup.

**invitation_tokens table:**

| Column | Type | Constraints |
|--------|------|-------------|
| invitation_id | UUID | PK |
| physician_user_id | UUID FK | NOT NULL, FK → users |
| delegate_email | VARCHAR(255) | NOT NULL |
| token_hash | VARCHAR(255) | NOT NULL, UNIQUE |
| permissions | JSONB | NOT NULL |
| expires_at | TIMESTAMPTZ | NOT NULL |
| accepted | BOOLEAN | NOT NULL, DEFAULT false |
| created_at | TIMESTAMPTZ | NOT NULL |

Index: (token_hash), (physician_user_id, accepted).

## Critical Security Rules

- Session tokens: only the SHA-256 hash is stored. Plaintext exists only in the HTTP-only cookie.
- Invitation tokens: only the SHA-256 hash is stored. Plaintext exists only in the email link.
- Recovery codes: hashed with Argon2id (same as passwords). Original shown once at generation.

## Prerequisites

This task depends on the following completed tasks: D01-002

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].
# Task D01-040: Security: authentication enforcement on every route

## What to Build

Create `apps/api/test/security/iam/iam.authn.security.ts`.

Test every authenticated route in the IAM domain returns 401 without a valid session cookie. This includes:

- POST /api/v1/auth/mfa/setup
- POST /api/v1/auth/mfa/confirm
- POST /api/v1/auth/logout
- GET /api/v1/sessions
- DELETE /api/v1/sessions/:id
- DELETE /api/v1/sessions
- POST /api/v1/delegates/invite
- GET /api/v1/delegates
- PATCH /api/v1/delegates/:id/permissions
- DELETE /api/v1/delegates/:id
- GET /api/v1/delegates/physicians
- GET /api/v1/account
- PATCH /api/v1/account
- POST /api/v1/account/mfa/regenerate-codes
- POST /api/v1/account/mfa/reconfigure
- POST /api/v1/account/delete
- GET /api/v1/account/audit-log

For each route: send request with no cookie, with expired cookie, and with tampered cookie. All must return 401 with no data leakage in the response body.

## Critical Security Rules

- 401 responses must not contain any data in the response body beyond the error object.
- Tampered cookies must be rejected (invalid signature / hash mismatch).
- Expired sessions must return 401 (not 200 with stale data).

## Prerequisites

This task depends on the following completed tasks: D01-031, D01-032

## Run After Completion

```bash
pnpm --filter api vitest run test/security/iam/iam.authn.security.ts
```

All tests must pass before outputting [TASK_COMPLETE].
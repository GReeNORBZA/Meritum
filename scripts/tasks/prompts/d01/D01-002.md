# Task D01-002: Drizzle schema for users table

## What to Build

Create `packages/shared/src/schemas/db/iam.schema.ts` starting with the users table.

**users table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| user_id | UUID | PK | Default: gen_random_uuid() |
| email | VARCHAR(255) | NOT NULL, UNIQUE | Normalised to lowercase |
| password_hash | VARCHAR(255) | NOT NULL | Argon2id hash |
| full_name | VARCHAR(200) | NOT NULL | Display name |
| phone | VARCHAR(20) | NULLABLE | For support recovery |
| role | VARCHAR(20) | NOT NULL, DEFAULT 'physician' | physician, delegate, admin |
| email_verified | BOOLEAN | NOT NULL, DEFAULT false | Set true on verification |
| mfa_configured | BOOLEAN | NOT NULL, DEFAULT false | Set true after MFA setup |
| totp_secret_encrypted | TEXT | NULLABLE | AES-256-GCM encrypted TOTP secret |
| subscription_status | VARCHAR(20) | NOT NULL, DEFAULT 'trial' | Stripe-driven status |
| failed_login_count | INTEGER | NOT NULL, DEFAULT 0 | Reset on successful login |
| locked_until | TIMESTAMPTZ | NULLABLE | Set after 10 failed logins (30 min lock) |
| is_active | BOOLEAN | NOT NULL, DEFAULT true | Soft delete |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |
| updated_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |

**Indexes:** unique on email, index on (role, is_active), index on subscription_status.

Export the table and its inferred types (InsertUser, SelectUser) from the schema file.

## Critical Security Rules

- totp_secret_encrypted is AES-256-GCM encrypted. The encryption key is stored in environment variables, never in the database.
- password_hash uses Argon2id with parameters: memory 19456 KiB, iterations 2, parallelism 1.
- email is normalised to lowercase before storage to prevent duplicate accounts with case variation.

## Prerequisites

This task depends on the following completed tasks: D01-001

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].
# Task D01-044: Security: data leakage prevention and anti-enumeration

## What to Build

Create `apps/api/test/security/iam/iam.leakage.security.ts`.

**Anti-enumeration tests:**
- POST /auth/register with existing email returns same 200 as new email
- POST /auth/password/reset-request with non-existent email returns same 200 as existing email
- POST /auth/login with non-existent email returns same error as wrong password (no timing difference measurable in integration test)

**Error response sanitisation:**
- 401 response body contains only error object, no user data
- 403 response body does not reveal what permission is missing (generic 'Insufficient permissions')
- 404 response for cross-user resource does not confirm resource exists
- 500 error does not expose stack traces, SQL errors, or internal details

**Header checks:**
- No X-Powered-By header
- No Server header revealing version
- HSTS header present
- CSP headers present

**Sensitive data not in responses:**
- GET /account does not return password_hash
- GET /account does not return totp_secret_encrypted
- GET /delegates does not return delegate's password_hash
- Audit log entries do not contain plaintext passwords or tokens

## Prerequisites

This task depends on the following completed tasks: D01-031, D01-032

## Run After Completion

```bash
pnpm --filter api vitest run test/security/iam/iam.leakage.security.ts
```

All tests must pass before outputting [TASK_COMPLETE].
# Task D04A-003: Drizzle schema for ahcip_batches table

## Project Context
- Monorepo: Turborepo + pnpm workspaces
- API: `apps/api` (Fastify 5, TypeScript)
- Shared: `packages/shared` (Drizzle schemas, Zod validators, constants)
- DB: PostgreSQL 16 with Drizzle ORM
- Test: Vitest + Supertest
- Auth: Lucia sessions with RBAC middleware from Domain 1
- All queries MUST include physician_id for tenant isolation (HIA custodian boundary)
- Claims contain PHI — no PHI in logs, errors, or emails. PHN masked as 123******
- Domain 4.0 (Claim Lifecycle Core) provides base claims table, state machine, shared validation (S1-S7)
- This domain extends D04 Core with AHCIP-specific validation (A1-A19), fee calculation, batch cycle, and H-Link file generation

## What to Build

Add to `packages/shared/src/schemas/db/ahcip.schema.ts`:

**ahcip_batches table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| ahcip_batch_id | UUID | PK | |
| physician_id | UUID FK | NOT NULL, FK → providers | |
| ba_number | VARCHAR(10) | NOT NULL | BA for this batch. PCPCM may have 2 batches. |
| batch_week | DATE | NOT NULL | Thursday date for this batch cycle |
| status | VARCHAR(20) | NOT NULL | ASSEMBLING, GENERATED, SUBMITTED, RESPONSE_RECEIVED, RECONCILED, ERROR |
| claim_count | INTEGER | NOT NULL | Number of claims in batch |
| total_submitted_value | DECIMAL(12,2) | NOT NULL | Sum of submitted fees |
| file_path | VARCHAR(255) | NULLABLE | Path to generated H-Link file (encrypted) |
| file_hash | VARCHAR(64) | NULLABLE | SHA-256 of generated file |
| submission_reference | VARCHAR(50) | NULLABLE | H-Link submission reference |
| submitted_at | TIMESTAMPTZ | NULLABLE | When transmitted to AHCIP |
| response_received_at | TIMESTAMPTZ | NULLABLE | When assessment processed |
| created_at | TIMESTAMPTZ | NOT NULL | |
| created_by | UUID FK | NOT NULL | SYSTEM for auto, user for manual |

**Indexes:** (physician_id, batch_week DESC), (status), unique on (physician_id, ba_number, batch_week).

Export table and inferred types (InsertAhcipBatch, SelectAhcipBatch).

Use Drizzle ORM schema definition patterns consistent with existing schemas in `packages/shared/src/schemas/db/`. See `CLAUDE.md` for coding conventions.

## FRD References

- Domain 4.1 Section 2.2: ahcip_batches table — 14 columns. Batches grouped by physician_id + ba_number per week.
- Domain 4.1 Section 3.2: Batch assembly rules — grouped by physician + BA, PCPCM dual-BA generates two batches.

## Security Requirements

- file_path points to an AES-256 encrypted H-Link file. Never serve raw file content via API.
- submission_reference is sensitive — used for H-Link tracking. Do not expose in logs.
- Unique constraint on (physician_id, ba_number, batch_week) prevents duplicate batches per cycle.

## Dependencies

- D04A-002 must be complete (ahcip_claim_details schema in the same file).

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

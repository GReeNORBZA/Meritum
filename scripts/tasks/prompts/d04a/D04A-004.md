# Task D04A-004: Zod validation schemas for AHCIP claim details, batch, fee, and assessment endpoints

## Project Context
- Monorepo: Turborepo + pnpm workspaces
- API: `apps/api` (Fastify 5, TypeScript)
- Shared: `packages/shared` (Drizzle schemas, Zod validators, constants)
- DB: PostgreSQL 16 with Drizzle ORM
- Test: Vitest + Supertest
- Auth: Lucia sessions with RBAC middleware from Domain 1
- All queries MUST include physician_id for tenant isolation (HIA custodian boundary)
- Claims contain PHI â€” no PHI in logs, errors, or emails. PHN masked as 123******
- Domain 4.0 (Claim Lifecycle Core) provides base claims table, state machine, shared validation (S1-S7)
- This domain extends D04 Core with AHCIP-specific validation (A1-A19), fee calculation, batch cycle, and H-Link file generation

## What to Build

Create `packages/shared/src/schemas/ahcip.schema.ts` with Zod schemas:

**AHCIP claim detail creation (extends base claim):**
- createAhcipDetailSchema: { health_service_code: string().min(1).max(10), functional_centre: string().min(1).max(10), encounter_type: enum(EncounterTypes), modifier_1: string().max(6).optional(), modifier_2: string().max(6).optional(), modifier_3: string().max(6).optional(), diagnostic_code: string().max(8).optional(), facility_number: string().max(10).optional(), referral_practitioner: string().max(10).optional(), calls: number().int().min(1).default(1), time_spent: number().int().min(1).optional(), patient_location: string().max(10).optional() }

**AHCIP claim detail update:**
- updateAhcipDetailSchema: partial of createAhcipDetailSchema. health_service_code is editable.

**Batch endpoints:**
- listBatchesSchema: { status: enum(AhcipBatchStatus).optional(), date_from: date.optional(), date_to: date.optional(), page: number().int().min(1).default(1), page_size: number().int().min(1).max(50).default(20) }
- batchIdParamSchema: { id: uuid() }

**Fee calculation:**
- feeCalculateSchema: same as createAhcipDetailSchema + { date_of_service: date, patient_id: uuid() } (for preview without saving)

**Assessment query:**
- batchAssessmentParamSchema: { batch_id: uuid() }

Export all schemas and inferred types. Use Zod patterns consistent with existing schema files in `packages/shared/src/schemas/`. See `CLAUDE.md` for coding conventions.

## FRD References

- Domain 4.1 Section 2.1: AHCIP claim detail fields with types and constraints.
- Domain 4.1 Section 8.1: Batch management endpoints.
- Domain 4.1 Section 8.3: Fee calculation endpoint.

## Dependencies

- D04A-001 must be complete (AHCIP constants for enums used in Zod schemas).

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

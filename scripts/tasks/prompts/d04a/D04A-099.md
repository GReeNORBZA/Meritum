# Task D04A-099: Full domain test suite — all unit + integration + security tests

## Project Context
- Monorepo: Turborepo + pnpm workspaces
- API: `apps/api` (Fastify 5, TypeScript)
- Shared: `packages/shared` (Drizzle schemas, Zod validators, constants)
- DB: PostgreSQL 16 with Drizzle ORM
- Test: Vitest + Supertest
- Auth: Lucia sessions with RBAC middleware from Domain 1
- All queries MUST include physician_id for tenant isolation (HIA custodian boundary)
- Claims contain PHI — no PHI in logs, errors, or emails. PHN masked as 123******
- Domain 4.0 (Claim Lifecycle Core) provides base claims table, state machine, shared validation (S1-S7)
- This domain extends D04 Core with AHCIP-specific validation (A1-A19), fee calculation, batch cycle, and H-Link file generation

## What to Build

Run the complete test suite for Domain 4.1 AHCIP Claim Pathway. Do NOT write new code unless tests fail.

1. Run all unit tests: `pnpm --filter api vitest run src/domains/ahcip/`
2. Run all integration tests: `pnpm --filter api vitest run test/integration/ahcip/`
3. Run all security tests: `pnpm --filter api vitest run test/security/ahcip/`

If any tests fail: read the failure, fix the source code (not the tests unless the test is wrong), re-run.

After all pass, run the full suite one final time:
```bash
pnpm --filter api vitest run src/domains/ahcip/ test/integration/ahcip/ test/security/ahcip/
```

Verify these security test files exist and are non-empty:
- test/security/ahcip/ahcip.authn.security.ts
- test/security/ahcip/ahcip.authz.security.ts
- test/security/ahcip/ahcip.scoping.security.ts
- test/security/ahcip/ahcip.input.security.ts
- test/security/ahcip/ahcip.leakage.security.ts
- test/security/ahcip/ahcip.audit.security.ts

## Dependencies

- D04A-040 must be complete (authn security tests).
- D04A-041 must be complete (authz security tests).
- D04A-042 must be complete (scoping security tests).
- D04A-043 must be complete (input security tests).
- D04A-044 must be complete (leakage security tests).
- D04A-045 must be complete (audit security tests).

## Run After Completion

```bash
pnpm --filter api vitest run src/domains/ahcip/ test/integration/ahcip/ test/security/ahcip/
```

All tests must pass before outputting [TASK_COMPLETE].

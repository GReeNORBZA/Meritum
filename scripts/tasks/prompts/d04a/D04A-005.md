# Task D04A-005: Generate and apply database migration for AHCIP tables

## Project Context
- Monorepo: Turborepo + pnpm workspaces
- API: `apps/api` (Fastify 5, TypeScript)
- Shared: `packages/shared` (Drizzle schemas, Zod validators, constants)
- DB: PostgreSQL 16 with Drizzle ORM
- Test: Vitest + Supertest
- Auth: Lucia sessions with RBAC middleware from Domain 1
- All queries MUST include physician_id for tenant isolation (HIA custodian boundary)
- Claims contain PHI — no PHI in logs, errors, or emails. PHN masked as 123******
- Domain 4.0 (Claim Lifecycle Core) provides base claims table, state machine, shared validation (S1-S7)
- This domain extends D04 Core with AHCIP-specific validation (A1-A19), fee calculation, batch cycle, and H-Link file generation

## What to Build

Run the Drizzle migration generator for AHCIP tables:

```bash
cd apps/api
pnpm drizzle-kit generate
pnpm drizzle-kit migrate
```

Verify migration file created in `apps/api/drizzle/migrations/`.
Verify tables exist: ahcip_claim_details, ahcip_batches.
Verify FK from ahcip_claim_details.claim_id → claims.claim_id (Domain 4.0).
Verify unique constraint on (physician_id, ba_number, batch_week) for ahcip_batches.
Verify unique constraint on claim_id for ahcip_claim_details.

## Dependencies

- D04A-002 must be complete (ahcip_claim_details Drizzle schema).
- D04A-003 must be complete (ahcip_batches Drizzle schema).
- Domain 4.0 migration must have been applied (claims table exists for FK reference).

## Run After Completion

```bash
cd apps/api && pnpm drizzle-kit generate 2>&1 && pnpm drizzle-kit migrate 2>&1
```

All tests must pass before outputting [TASK_COMPLETE].

# Task D05-005: Drizzle schema for wcb_configurations and delegate_relationships tables

## What to Build

Add to `packages/shared/src/schemas/db/provider.schema.ts`:

**wcb_configurations table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| wcb_config_id | UUID | PK | Default: gen_random_uuid() |
| provider_id | UUID FK | NOT NULL, FK -> providers | |
| contract_id | VARCHAR(10) | NOT NULL | WCB Contract ID (e.g., 000001, 000006, 000053) |
| role_code | VARCHAR(10) | NOT NULL | WCB Role code (e.g., GP, SP, OR, OIS) |
| skill_code | VARCHAR(10) | NULLABLE | WCB Skill code. Defaults based on specialty |
| permitted_form_types | JSONB | NOT NULL | Array of form IDs this Contract ID/Role can create |
| is_default | BOOLEAN | NOT NULL, DEFAULT false | Default WCB config for this provider |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |
| updated_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |

Constraints: UNIQUE on (provider_id, contract_id). At most one default per provider.

Indexes: (provider_id), unique on (provider_id, contract_id).

**delegate_relationships table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| relationship_id | UUID | PK | Default: gen_random_uuid() |
| physician_id | UUID FK | NOT NULL, FK -> providers | The physician granting delegation |
| delegate_user_id | UUID FK | NOT NULL, FK -> users (Domain 1) | The delegate receiving permissions |
| permissions | JSONB | NOT NULL | Array of permission keys granted (subset of 24) |
| status | VARCHAR(20) | NOT NULL, DEFAULT 'INVITED' | ACTIVE, INVITED, REVOKED |
| invited_at | TIMESTAMPTZ | NOT NULL | When the invitation was sent |
| accepted_at | TIMESTAMPTZ | NULLABLE | When the delegate accepted |
| revoked_at | TIMESTAMPTZ | NULLABLE | When the physician revoked access |
| revoked_by | UUID FK | NULLABLE | Who revoked (physician or admin) |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |
| updated_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |

Constraints: UNIQUE on (physician_id, delegate_user_id) for active relationships.

Indexes: (physician_id, status), (delegate_user_id, status).

Export tables and inferred types (InsertWcbConfig, SelectWcbConfig, InsertDelegateRelationship, SelectDelegateRelationship).

Use Drizzle ORM schema definitions. Follow existing schema patterns in `packages/shared/src/schemas/db/`. See `CLAUDE.md` for coding conventions.

## Critical Security Rules

- delegate_relationships scoped to physician_id -- tenant isolation critical.
- permitted_form_types in wcb_configurations is derived from the WCB matrix and must be validated against it at creation time.

## Prerequisites

- D05-002 must be complete (providers table defined).

## FRD Reference

- Domain 5 Section 2.5: WCB Configuration table. Multiple Contract IDs per provider. Each maps to Role code and permitted form types from WCB matrix.
- Domain 5 Section 2.6: Delegate Relationships table. Tracks physician-delegate linkage with JSONB permissions. Statuses: ACTIVE, INVITED, REVOKED.

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

# Task D05-003: Drizzle schema for business_arrangements and pcpcm_enrolments tables

## What to Build

Add to `packages/shared/src/schemas/db/provider.schema.ts`:

**business_arrangements table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| ba_id | UUID | PK | Default: gen_random_uuid() |
| provider_id | UUID FK | NOT NULL, FK -> providers | |
| ba_number | VARCHAR(10) | NOT NULL | Business Arrangement number from Alberta Health |
| ba_type | VARCHAR(10) | NOT NULL | FFS, PCPCM, ARP |
| is_primary | BOOLEAN | NOT NULL | For dual-BA, FFS BA is primary |
| status | VARCHAR(20) | NOT NULL, DEFAULT 'PENDING' | ACTIVE, PENDING, INACTIVE |
| effective_date | DATE | NULLABLE | When BA became active |
| end_date | DATE | NULLABLE | When BA was deactivated (null if active) |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |
| updated_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |

Constraints: ba_number unique across active records. Max 2 active BAs per provider (enforced at service layer). If ba_type = PCPCM, a second BA with ba_type = FFS must exist.

Indexes: (provider_id, status), unique partial index on (ba_number) WHERE status != 'INACTIVE'.

**pcpcm_enrolments table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| enrolment_id | UUID | PK | Default: gen_random_uuid() |
| provider_id | UUID FK | NOT NULL, FK -> providers | |
| pcpcm_ba_id | UUID FK | NOT NULL, FK -> business_arrangements | The PCPCM BA |
| ffs_ba_id | UUID FK | NOT NULL, FK -> business_arrangements | The paired FFS BA |
| panel_size | INTEGER | NULLABLE | Current PCPCM panel size, updated periodically |
| enrolment_date | DATE | NOT NULL | When physician enrolled in PCPCM |
| status | VARCHAR(20) | NOT NULL, DEFAULT 'PENDING' | ACTIVE, PENDING, WITHDRAWN |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |
| updated_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |

Indexes: unique on (provider_id) for active enrolments, (provider_id, status).

Export tables and inferred types (InsertBa, SelectBa, InsertPcpcmEnrolment, SelectPcpcmEnrolment).

Use Drizzle ORM schema definitions. Follow existing schema patterns in `packages/shared/src/schemas/db/`. See `CLAUDE.md` for coding conventions.

## Prerequisites

- D05-002 must be complete (providers table defined).

## FRD Reference

- Domain 5 Section 2.2: Business Arrangements table. Max 2 active BAs per provider. PCPCM requires paired FFS BA. ba_number unique across active records.
- Domain 5 Section 2.4: PCPCM Enrolments table. Tracks dual-BA linkage and panel size.

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

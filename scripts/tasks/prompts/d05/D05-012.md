# Task D05-012: Repository â€” practice location management

## What to Build

Add to `apps/api/src/domains/provider/provider.repository.ts`:

- `createLocation(data: InsertLocation)` -- insert practice location.
- `findLocationById(locationId: string, providerId: string)` -- find location scoped to provider.
- `listLocationsForProvider(providerId: string)` -- list all locations.
- `listActiveLocationsForProvider(providerId: string)` -- list active locations (for claim creation dropdown).
- `updateLocation(locationId: string, providerId: string, data: Partial<InsertLocation>)` -- update location fields.
- `setDefaultLocation(locationId: string, providerId: string)` -- unset current default, set this as default. Transaction required.
- `deactivateLocation(locationId: string, providerId: string)` -- set is_active = false. If this was default, clear is_default.
- `getDefaultLocation(providerId: string)` -- return the default location or null.

Use Drizzle ORM query builder with the provider schema. All queries scoped to providerId. Follow existing repository patterns. See `CLAUDE.md` for coding conventions.

## Critical Security Rules

- All location queries scoped to providerId.
- setDefaultLocation uses a transaction to ensure exactly one default at all times.

## Prerequisites

- D05-009 must be complete (database migration applied).

## Tests to Write

Add tests in `apps/api/src/domains/provider/provider.test.ts`:

- createLocation inserts location record
- listActiveLocationsForProvider returns only active locations
- updateLocation updates fields scoped to provider
- updateLocation rejects if location belongs to different provider
- setDefaultLocation unsets previous default and sets new
- deactivateLocation sets is_active false
- deactivateLocation clears is_default if was default
- getDefaultLocation returns default location

## FRD Reference

- Domain 5 Section 2.3: Practice Locations table. Multi-site support. Each location maps to an AHCIP functional centre.

## Run After Completion

```bash
pnpm --filter api vitest run src/domains/provider/provider.test.ts
```

All tests must pass before outputting [TASK_COMPLETE].

# Task D05-009: Generate and apply database migration for all provider tables

## What to Build

Run the Drizzle migration generator for all Provider Management tables:

```bash
cd apps/api
pnpm drizzle-kit generate
pnpm drizzle-kit migrate
```

**Verify migration file created in `apps/api/drizzle/migrations/`.**

**Verify all 8 tables exist:**
1. providers
2. business_arrangements
3. pcpcm_enrolments
4. practice_locations
5. wcb_configurations
6. delegate_relationships
7. submission_preferences
8. hlink_configurations

**Verify all FK relationships:**
- providers.provider_id -> users.user_id (Domain 1)
- business_arrangements.provider_id -> providers.provider_id
- pcpcm_enrolments.provider_id -> providers.provider_id
- pcpcm_enrolments.pcpcm_ba_id -> business_arrangements.ba_id
- pcpcm_enrolments.ffs_ba_id -> business_arrangements.ba_id
- practice_locations.provider_id -> providers.provider_id
- wcb_configurations.provider_id -> providers.provider_id
- delegate_relationships.physician_id -> providers.provider_id
- delegate_relationships.delegate_user_id -> users.user_id (Domain 1)
- submission_preferences.provider_id -> providers.provider_id
- hlink_configurations.provider_id -> providers.provider_id

**Verify unique constraints:**
- providers.billing_number (unique)
- providers.cpsa_registration_number (unique)
- business_arrangements: partial unique on ba_number WHERE status != 'INACTIVE'
- wcb_configurations: unique on (provider_id, contract_id)
- submission_preferences: unique on provider_id
- hlink_configurations: unique on provider_id

**Verify indexes:**
- providers: specialty_code, status
- business_arrangements: (provider_id, status)
- pcpcm_enrolments: (provider_id, status)
- practice_locations: (provider_id, is_active), (provider_id, is_default)
- wcb_configurations: (provider_id)
- delegate_relationships: (physician_id, status), (delegate_user_id, status)

If the migration fails, review the schema file for errors, fix them, and re-run.

## Prerequisites

- D05-002 through D05-006 must all be complete (all table schemas defined).
- Database must be running and accessible.

## Run After Completion

```bash
cd apps/api && pnpm drizzle-kit generate 2>&1 && pnpm drizzle-kit migrate 2>&1
```

All migrations must apply cleanly before outputting [TASK_COMPLETE].

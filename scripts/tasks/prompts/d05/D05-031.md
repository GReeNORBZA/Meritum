# Task D05-031: Routes â€” WCB configuration and submission preferences endpoints

## What to Build

Add to `apps/api/src/domains/provider/provider.routes.ts` and handlers:

**WCB routes (auth required):**
- `GET /api/v1/providers/me/wcb` -> listWcbConfigsHandler
- `POST /api/v1/providers/me/wcb` -> addWcbConfigHandler (body: createWcbConfigSchema)
- `PUT /api/v1/providers/me/wcb/:id` -> updateWcbConfigHandler (body: updateWcbConfigSchema, params: wcbConfigIdParamSchema)
- `DELETE /api/v1/providers/me/wcb/:id` -> removeWcbConfigHandler (params: wcbConfigIdParamSchema)
- `GET /api/v1/providers/me/wcb/form-permissions` -> formPermissionsHandler

**Submission preferences routes (auth required):**
- `GET /api/v1/providers/me/submission-preferences` -> getPreferencesHandler
- `PUT /api/v1/providers/me/submission-preferences` -> updatePreferencesHandler (body: updateSubmissionPreferencesSchema)

**H-Link routes (auth required, physician only):**
- `GET /api/v1/providers/me/hlink` -> getHlinkConfigHandler
- `PUT /api/v1/providers/me/hlink` -> updateHlinkConfigHandler (body: updateHlinkConfigSchema)

All handlers follow the thin handler pattern: validate via Zod schema, extract providerId from auth context, call service, format response. Register routes in the Fastify plugin. Follow existing route patterns. See `CLAUDE.md` for coding conventions.

Create integration test files:
- `apps/api/test/integration/provider/wcb.integration.ts`
- `apps/api/test/integration/provider/preferences.integration.ts`
- `apps/api/test/integration/provider/hlink.integration.ts`

## Critical Security Rules

- H-Link config GET response must never include credential_secret_ref.
- H-Link config PUT does not accept credential values -- credential rotation is a separate secrets management operation.
- Submission preferences update requires physician role or delegate with PREFERENCE_EDIT.

## Prerequisites

- D05-024 must be complete (WCB configuration service).
- D05-026 must be complete (submission preferences and H-Link service).

## Tests to Write

Create integration tests:

- GET /providers/me/wcb returns all WCB configs
- POST /providers/me/wcb validates against WCB matrix
- POST /providers/me/wcb auto-populates permitted_form_types
- DELETE /providers/me/wcb/:id removes config
- GET /providers/me/wcb/form-permissions returns aggregated forms
- GET /providers/me/submission-preferences returns current preferences
- PUT /providers/me/submission-preferences updates modes
- GET /providers/me/hlink returns config without credentials
- PUT /providers/me/hlink updates submitter prefix

## FRD Reference

- Domain 5 Section 5.5-5.7: API contracts for WCB, submission preferences, H-Link endpoints.
- Domain 5 Section 4.1 PRV-004: WCB setup with Contract ID dropdown.
- Domain 5 Section 4.3 PRV-011: Submission preference user story.

## Run After Completion

```bash
pnpm --filter api vitest run test/integration/provider/
```

All tests must pass before outputting [TASK_COMPLETE].

# Task D05-033: Routes â€” internal provider context API endpoints

## What to Build

Add to `apps/api/src/domains/provider/provider.routes.ts` and handlers:

**Internal API routes (service-to-service, not exposed to UI):**
- `GET /api/v1/internal/providers/:id/claim-context` -> claimContextHandler (params: providerIdParamSchema)
- `GET /api/v1/internal/providers/:id/ba-for-claim` -> baForClaimHandler (params: providerIdParamSchema, query: baForClaimQuerySchema)
- `GET /api/v1/internal/providers/:id/wcb-config-for-form` -> wcbConfigForFormHandler (params: providerIdParamSchema, query: wcbConfigForFormQuerySchema)

These routes are consumed by Domain 4 (Claim Lifecycle). They require internal service authentication (not user session -- use a shared internal API key or service token). The routes bypass standard user auth middleware but still validate the requested provider exists.

**Internal auth middleware:**
- Check for `X-Internal-Api-Key` header or equivalent internal service token.
- Reject requests without valid internal authentication.
- Do NOT use standard user session middleware on these routes.

All handlers follow the thin handler pattern. Register routes in the Fastify plugin under the `/api/v1/internal/` prefix. Follow existing route patterns. See `CLAUDE.md` for coding conventions.

Create integration test file:
- `apps/api/test/integration/provider/internal.integration.ts`

## Critical Security Rules

- Internal API routes must NOT be accessible from the public API. Use a route prefix guard or internal API key validation.
- Even internal routes scope data to the requested provider_id -- no cross-provider leakage.
- Internal routes do not carry user auth context -- they are service-to-service.

## Prerequisites

- D05-027 must be complete (provider context service).

## Tests to Write

Create integration tests:

- GET /internal/providers/:id/claim-context returns full ProviderContext
- GET /internal/providers/:id/claim-context returns 404 for unknown provider
- GET /internal/providers/:id/ba-for-claim returns correct BA for AHCIP (non-PCPCM)
- GET /internal/providers/:id/ba-for-claim returns PCPCM BA for in-basket code
- GET /internal/providers/:id/ba-for-claim returns FFS BA for out-of-basket code
- GET /internal/providers/:id/wcb-config-for-form returns matching config
- GET /internal/providers/:id/wcb-config-for-form returns 404 for non-permitted form
- Internal routes reject requests without internal API key

## FRD Reference

- Domain 5 Section 5.8: Internal Provider Context API endpoints.
- Domain 5 Section 6: Provider Context Object -- 17 fields consumed by Domain 4.

## Run After Completion

```bash
pnpm --filter api vitest run test/integration/provider/
```

All tests must pass before outputting [TASK_COMPLETE].

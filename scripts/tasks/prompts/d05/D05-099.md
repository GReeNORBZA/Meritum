# Task D05-099: Full domain test suite â€” all unit + integration + security tests

## What to Build

Run the complete test suite for Domain 5 Provider Management. Do NOT write new code unless tests fail.

1. Run all unit tests:
```bash
pnpm --filter api vitest run src/domains/provider/
```

2. Run all integration tests:
```bash
pnpm --filter api vitest run test/integration/provider/
```

3. Run all security tests:
```bash
pnpm --filter api vitest run test/security/provider/
```

If any tests fail: read the failure output, diagnose the root cause, fix the source code (not the tests unless the test itself is incorrect), and re-run the failing test file.

After all individual suites pass, run the full suite one final time:
```bash
pnpm --filter api vitest run src/domains/provider/ test/integration/provider/ test/security/provider/
```

**Verify these security test files exist and are non-empty:**
- `apps/api/test/security/provider/provider.authn.security.ts`
- `apps/api/test/security/provider/provider.authz.security.ts`
- `apps/api/test/security/provider/provider.scoping.security.ts`
- `apps/api/test/security/provider/provider.input.security.ts`
- `apps/api/test/security/provider/provider.leakage.security.ts`
- `apps/api/test/security/provider/provider.audit.security.ts`

**Verify these source files exist:**
- `packages/shared/src/constants/provider.constants.ts`
- `packages/shared/src/schemas/db/provider.schema.ts`
- `packages/shared/src/schemas/provider.schema.ts`
- `apps/api/src/domains/provider/provider.repository.ts`
- `apps/api/src/domains/provider/provider.service.ts`
- `apps/api/src/domains/provider/provider.routes.ts`
- `apps/api/src/domains/provider/provider.handlers.ts`

**Verify these integration test files exist:**
- `apps/api/test/integration/provider/profile.integration.ts`
- `apps/api/test/integration/provider/ba.integration.ts`
- `apps/api/test/integration/provider/locations.integration.ts`
- `apps/api/test/integration/provider/wcb.integration.ts`
- `apps/api/test/integration/provider/preferences.integration.ts`
- `apps/api/test/integration/provider/hlink.integration.ts`
- `apps/api/test/integration/provider/delegates.integration.ts`
- `apps/api/test/integration/provider/internal.integration.ts`

If any file is missing, investigate which prior task failed to create it and report the issue.

## Critical Security Rules

- All 6 security test files must exist and pass.
- No test should be skipped or commented out.
- Security tests must not be weakened to make them pass -- fix the source code instead.

## Prerequisites

- All previous Domain 5 tasks must be complete:
  - D05-040 through D05-045 (all security tests).
  - D05-030 through D05-033 (all routes and integration tests).
  - D05-020 through D05-027 (all service layer tasks).
  - D05-010 through D05-016 (all repository tasks).
  - D05-001 through D05-009 (all shared types, schemas, and migration).

## Run After Completion

```bash
pnpm --filter api vitest run src/domains/provider/ test/integration/provider/ test/security/provider/
```

All tests must pass before outputting [TASK_COMPLETE].

# D13-099: Full domain test suite: all unit + integration + security tests

**Domain:** 13 â€” Support System
**Task ID:** D13-099
**Depends on:** D13-040, D13-041, D13-042, D13-043, D13-044, D13-045
**Verify:** `pnpm --filter api vitest run src/domains/support/ test/integration/support/ test/security/support/`

---

## Build Instructions

Run the complete test suite for Domain 13 Support System. Do NOT write new code unless tests fail.

1. Run all unit tests: `pnpm --filter api vitest run src/domains/support/`
2. Run all integration tests: `pnpm --filter api vitest run test/integration/support/`
3. Run all security tests: `pnpm --filter api vitest run test/security/support/`

If any tests fail: read the failure, fix the source code (not the tests unless the test is wrong), re-run.

After all pass, run the full suite one final time:
```bash
pnpm --filter api vitest run src/domains/support/ test/integration/support/ test/security/support/
```

Verify these security test files exist and are non-empty:
- test/security/support/support.authn.security.ts
- test/security/support/support.authz.security.ts
- test/security/support/support.scoping.security.ts
- test/security/support/support.input.security.ts
- test/security/support/support.leakage.security.ts
- test/security/support/support.audit.security.ts

Verify all Domain 13 API endpoints are registered and reachable:
- 2 public help endpoints (GET articles, GET article by slug)
- 1 authenticated help endpoint (POST feedback)
- 4 ticket endpoints (POST create, GET list, GET detail, POST rating)

Total: 7 routes (2 public + 5 authenticated), 3 DB tables, 6 security test suites.

This is the FINAL domain in the Meritum build. All 14 domains are now complete.

---

## Codebase Context

- **Full test command:** `pnpm --filter api vitest run src/domains/support/ test/integration/support/ test/security/support/`
- **Unit tests:** Co-located with source files in `apps/api/src/domains/support/`. Each repo and service file has a `.test.ts` companion.
- **Integration tests:** Located in `apps/api/test/integration/support/`. Test end-to-end workflows through HTTP requests.
- **Security tests:** Located in `apps/api/test/security/support/`. Test authentication, authorization, tenant isolation, input validation, PHI leakage, and audit completeness.
- **Fix source, not tests:** If a test fails, the issue is most likely in the source code (routes, services, repos, schemas). Only modify a test if the test itself is incorrect (wrong expected value, incorrect setup).
- **Domain completeness checklist:**
  - 3 DB tables: support_tickets, help_articles, article_feedback
  - 2 repositories: help-articles.repo.ts, support-tickets.repo.ts
  - 2 services: help-centre.service.ts, support-ticket.service.ts
  - 2 route files: help.routes.ts, ticket.routes.ts
  - 7 API routes total (2 public + 5 authenticated)
  - 6 security test suites
  - 4 integration test files
- **This is Domain 13 -- the final domain.** All prior domains (D01-D12) should already be complete. This task validates the entire support system end-to-end.

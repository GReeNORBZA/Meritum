# D13-005: Zod validation schemas for all support API inputs

**Domain:** 13 â€” Support System
**Task ID:** D13-005
**Depends on:** D13-001
**Verify:** `pnpm --filter shared build`

---

## Build Instructions

Create `packages/shared/src/schemas/validation/support.validation.ts` with Zod schemas:

**Help centre:**
- `ArticleListQuerySchema`: { category?: enum(HELP_CATEGORIES), search?: string(max 200), limit?: number(1-50, default 20), offset?: number }
- `ArticleSlugParamSchema`: { slug: string(max 200, alphanumeric + hyphens only) }
- `ArticleFeedbackSchema`: { is_helpful: boolean }

**Support tickets:**
- `CreateTicketSchema`: { subject: string(max 200), description: string(max 5000), context_url?: string(max 500, valid URL), context_metadata?: object, priority?: enum(PRIORITIES, default MEDIUM) }. Screenshot handled as multipart file upload, not in JSON body.
- `TicketListQuerySchema`: { status?: enum(TICKET_STATUSES), limit?: number(1-50, default 20), offset?: number }
- `TicketIdParamSchema`: { id: UUID }
- `TicketRatingSchema`: { rating: integer(1-5), comment?: string(max 1000) }

**Internal/admin ticket updates (support team only):**
- `UpdateTicketSchema`: { status?: enum(TICKET_STATUSES), category?: enum(TICKET_CATEGORIES), priority?: enum(PRIORITIES), assigned_to?: string(max 100), resolution_notes?: string(max 5000) }. At least one field required.

All UUIDs validated as v4. context_url validated as HTTPS URL. description sanitised for XSS.

Export all schemas.

---

## FRD References

- Domain 13 Section 6: API contracts (Table 5).
- Domain 13 Section 3.1: Support form -- subject, description, context, screenshot.
- Domain 13 Section 5: SUP-005 satisfaction rating 1-5 with optional comment.

---

## Security Requirements

- description max 5000 chars -- prevent unbounded text storage.
- context_url validated as HTTPS -- prevent javascript: or data: URI injection.
- context_metadata validated as object -- prevent arbitrary type injection.
- Screenshot upload handled separately via multipart -- size and type validation at route level.

---

## Codebase Context

- **Validation schemas location:** `packages/shared/src/schemas/validation/`. Follow existing Zod schema patterns from other domains.
- **Zod patterns:** Use `z.object()`, `z.string()`, `z.number().int()`, `z.enum()`, `z.boolean()`. For UUID validation: `z.string().uuid()`.
- **Constants integration:** Import ticket statuses, priorities, categories, and help centre categories from `packages/shared/src/constants/support.constants.ts` (D13-001) to use with `z.enum()`.
- **Barrel exports:** Update `packages/shared/src/schemas/index.ts` to re-export all validation schemas.
- **XSS sanitisation:** Use `.transform()` or `.refine()` to strip HTML tags from description fields if that is the existing pattern, or rely on output encoding.
- **HTTPS URL validation:** Use `z.string().url().refine(url => url.startsWith('https://'))` or equivalent pattern.

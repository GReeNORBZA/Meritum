# D13-003: Drizzle schema for help_articles table

**Domain:** 13 â€” Support System
**Task ID:** D13-003
**Depends on:** D13-001
**Verify:** `pnpm --filter shared build`

---

## Build Instructions

Add to `packages/shared/src/schemas/db/support.schema.ts` the help_articles table.

**help_articles table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| article_id | UUID | PK | Default: gen_random_uuid() |
| slug | VARCHAR(200) | NOT NULL, UNIQUE | URL-friendly identifier (e.g., 'understanding-thursday-batch') |
| title | VARCHAR(200) | NOT NULL | Article title |
| category | VARCHAR(50) | NOT NULL | One of HELP_CENTRE_CATEGORIES constants |
| content | TEXT | NOT NULL | Article body in Markdown format |
| summary | VARCHAR(500) | NULLABLE | Short description for search results |
| search_vector | TSVECTOR | NOT NULL | PostgreSQL full-text search vector, generated from title + content |
| related_codes | JSONB | NULLABLE | Array of related HSC codes, explanatory codes, or error codes for code-specific lookups |
| somb_version | VARCHAR(20) | NULLABLE | SOMB version this article references (for versioning) |
| is_published | BOOLEAN | NOT NULL, DEFAULT false | Only published articles visible to physicians |
| helpful_count | INTEGER | NOT NULL, DEFAULT 0 | Count of 'helpful' feedback |
| not_helpful_count | INTEGER | NOT NULL, DEFAULT 0 | Count of 'not helpful' feedback |
| sort_order | INTEGER | NOT NULL, DEFAULT 0 | Display order within category |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |
| updated_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |

**Indexes:**
- UNIQUE on slug
- GIN index on search_vector for full-text search
- Index on (category, is_published, sort_order) for category listing
- GIN index on related_codes for code-specific lookups

**Full-text search trigger:** Create a trigger or generated column that updates search_vector from title and content using `to_tsvector('english', title || ' ' || content)`.

Export table and inferred types (InsertHelpArticle, SelectHelpArticle).

---

## FRD References

- Domain 13 Section 2.1: Help centre structured by category (Table 1).
- Domain 13 Section 2.2: Full-text search, versioned, feedback loop ('Was this helpful?').
- Domain 13 Section 2.3: Context-aware help -- related_codes enables rejection code lookups.

---

## Security Requirements

- Help articles are NOT PHI -- they are public knowledge base content.
- is_published controls visibility -- draft articles hidden from physicians.
- No provider_id scoping needed -- articles are shared across all physicians.

---

## Codebase Context

- **DB schemas location:** `packages/shared/src/schemas/db/support.schema.ts` (same file as D13-002).
- **PostgreSQL full-text search:** Use `tsvector` column type from Drizzle. The `customType` helper or raw SQL may be needed for the tsvector type. GIN index for search performance.
- **Drizzle ORM pattern:** Follow existing schema patterns. For custom PostgreSQL types like tsvector, check how other domains handle custom column types.
- **Barrel exports:** Ensure InsertHelpArticle and SelectHelpArticle are exported via the schema barrel files.
- **Help articles are PUBLIC** -- they serve the help.meritum.ca public site for SEO. No auth required for read operations.

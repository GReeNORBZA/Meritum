# Task D06-004: Zod validation schemas for patient CRUD, search, import, merge, and export endpoints

## Project Context
- Monorepo: Turborepo + pnpm workspaces
- API: `apps/api` (Fastify 5, TypeScript)
- Shared: `packages/shared` (Drizzle schemas, Zod validators, constants)
- DB: PostgreSQL 16 with Drizzle ORM
- Test: Vitest + Supertest
- Auth: Lucia sessions with RBAC middleware from Domain 1
- All queries MUST include physician_id for tenant isolation (HIA custodian boundary)
- PHN is PHI — mask as 123****** in all logs and audit entries

## What to Build

Create `packages/shared/src/schemas/patient.schema.ts` with Zod schemas:

**Patient CRUD:**
- createPatientSchema: { phn: string().length(9).regex(/^\d{9}$/).optional().nullable(), phn_province: string().length(2).default('AB').optional(), first_name: string().min(1).max(50), middle_name: string().max(50).optional(), last_name: string().min(1).max(50), date_of_birth: string().date(), gender: enum(['M','F','X']), phone: string().max(24).optional(), email: string().email().max(100).optional(), address_line_1: string().max(100).optional(), address_line_2: string().max(100).optional(), city: string().max(50).optional(), province: string().max(2).optional(), postal_code: string().max(7).optional(), notes: string().optional() }
- updatePatientSchema: (same fields as create, all optional)
- patientIdParamSchema: { id: string().uuid() }

**Patient Search:**
- patientSearchQuerySchema: { phn: string().optional(), name: string().min(2).optional(), dob: string().date().optional(), page: number().int().min(1).default(1), page_size: number().int().min(1).max(100).default(20) }
- recentPatientsQuerySchema: { limit: number().int().min(1).max(50).default(20) }

**CSV Import:**
- importMappingSchema: { mapping: record(string(), string().nullable()) } — column name → patient field mapping
- importIdParamSchema: { id: string().uuid() }

**Patient Merge:**
- mergePreviewSchema: { surviving_id: string().uuid(), merged_id: string().uuid() }
- mergeExecuteSchema: { surviving_id: string().uuid(), merged_id: string().uuid() }

**Patient Export:**
- exportIdParamSchema: { id: string().uuid() }

**Internal API:**
- internalPatientIdParamSchema: { id: string().uuid() }
- validatePhnParamSchema: { phn: string().length(9).regex(/^\d{9}$/) }

Export all schemas AND their inferred TypeScript types.

## FRD References

- Domain 6 Section 8.1-8.6: API contracts for patient CRUD, search, import, merge, export, and internal endpoints.
- Domain 6 Section 3.1: PHN validation — 9 digits, numeric only.

## Dependencies

- D06-001 must be complete (patient constants and enums).

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

# Task D06-001: Patient constants, enums, audit action identifiers, PHN validation utility

## Project Context
- Monorepo: Turborepo + pnpm workspaces
- API: `apps/api` (Fastify 5, TypeScript)
- Shared: `packages/shared` (Drizzle schemas, Zod validators, constants)
- DB: PostgreSQL 16 with Drizzle ORM
- Test: Vitest + Supertest
- Auth: Lucia sessions with RBAC middleware from Domain 1
- All queries MUST include physician_id for tenant isolation (HIA custodian boundary)
- PHN is PHI — mask as 123****** in all logs and audit entries

## What to Build

Create `packages/shared/src/constants/patient.constants.ts` with all Patient Registry constants:

**Gender enum:** M, F, X

**Import status enum:** PENDING, PROCESSING, COMPLETED, FAILED

**PHN province defaults:** AB (Alberta), plus all Canadian province codes for reciprocal billing.

**Search modes enum:** PHN_LOOKUP, NAME_SEARCH, DOB_SEARCH, COMBINED, RECENT

**Import source enum:** MANUAL, CSV_IMPORT

**Patient audit action identifiers:**
- patient.created, patient.updated, patient.deactivated, patient.reactivated
- patient.merged
- patient.import_completed
- patient.export_requested, patient.export_downloaded
- patient.searched

**PHN validation utility function:**
Create `packages/shared/src/utils/phn.utils.ts`:
- `validateAlbertaPhn(phn: string): { valid: boolean; error?: string }` — validate 9-digit numeric Alberta PHN using Luhn algorithm (modulus 10, double-add-double on odd positions from right).
- `maskPhn(phn: string): string` — mask PHN for audit logs and admin views: show first 3 digits, replace remaining 6 with asterisks (e.g., 123******).

**CSV import column mappings (auto-detection headers):**
- phn: ['PHN', 'HealthNumber', 'AB_PHN']
- first_name: ['FirstName', 'First', 'GivenName']
- last_name: ['LastName', 'Last', 'Surname']
- date_of_birth: ['DOB', 'DateOfBirth', 'BirthDate']
- gender: ['Gender', 'Sex'] with value mappings: Male→M, Female→F
- phone: ['Phone', 'PhoneNumber', 'Tel']
- address_line_1: ['Address', 'Address1', 'Street']
- city: ['City', 'Town']
- postal_code: ['PostalCode', 'Postal', 'Zip']

Export all as frozen objects / TypeScript enums. Use `as const` and `Object.freeze` patterns consistent with other constant files in the project. See `CLAUDE.md` for coding conventions.

## FRD References

- Domain 6 Section 3.1: Alberta PHN format — 9 digits, Luhn check digit on 9th digit.
- Domain 6 Section 5.2: CSV import column mapping with common header aliases.
- Domain 6 Section 9.2: 7 audit action categories for patient registry.
- Domain 6 Section 9.3: PHN masking — first 3 shown, remaining 6 asterisks.

## Prerequisites

- None. This is the first task in Domain 6.
- The `packages/shared/src/constants/` directory must exist (created by Domain 1).

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

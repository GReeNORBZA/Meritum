# Task D12-032: Routes: status page (public) and admin incident management + integration tests

## What to Build

Add to `apps/api/src/domains/platform/platform.routes.ts` and handlers:

**Public status page routes (no auth required):**
- GET /api/v1/status → getStatusPageHandler (returns components + active incidents)
- GET /api/v1/status/incidents → getIncidentHistoryHandler (query: incidentHistoryQuerySchema)
- GET /api/v1/status/incidents/:id → getIncidentDetailHandler

**Admin incident management routes (auth required, admin role):**
- POST /api/v1/admin/incidents → createIncidentHandler (body: createIncidentSchema)
- POST /api/v1/admin/incidents/:id/updates → updateIncidentHandler (body: updateIncidentSchema)
- PATCH /api/v1/admin/components/:id/status → updateComponentStatusHandler (body: updateComponentStatusSchema)

Create `apps/api/test/integration/platform/status.integration.ts`.

## Critical Security Rules

- Status page routes are public — no authentication required.
- Incident management routes require admin role.
- Public status page must NOT expose any internal system details (no stack traces, no DB connection strings, no config).
- Incident messages are admin-authored free text — sanitise for XSS before storage.

## Prerequisites

This task depends on the following completed tasks: D12-023, D12-030

## Tests to Write

```typescript
  it('GET /status returns all components and active incidents without auth');
  it('GET /status/incidents returns paginated incident history');
  it('GET /status/incidents/:id returns incident with updates');
  it('POST /admin/incidents creates incident (admin only)');
  it('POST /admin/incidents rejects non-admin');
  it('POST /admin/incidents/:id/updates posts update');
  it('PATCH /admin/components/:id/status updates component status');
  it('PATCH /admin/components/:id/status rejects non-admin');
```

## Run After Completion

```bash
pnpm --filter api vitest run test/integration/platform/
```

All tests must pass before outputting [TASK_COMPLETE].

# Task D12-003: Drizzle schema for payment_history, status_components, status_incidents, incident_updates tables

## What to Build

Add to `packages/shared/src/schemas/db/platform.schema.ts`:

**payment_history table:**

| Column | Type | Constraints |
|--------|------|-------------|
| payment_id | UUID | PK |
| subscription_id | UUID FK | NOT NULL, FK → subscriptions |
| stripe_invoice_id | VARCHAR(50) | NOT NULL |
| amount_cad | DECIMAL(10,2) | NOT NULL (pre-GST amount) |
| gst_amount | DECIMAL(10,2) | NOT NULL (5% of amount_cad) |
| total_cad | DECIMAL(10,2) | NOT NULL (amount_cad + gst_amount) |
| status | VARCHAR(20) | NOT NULL (PAID, FAILED, REFUNDED) |
| paid_at | TIMESTAMPTZ | NULLABLE |
| created_at | TIMESTAMPTZ | NOT NULL |

Index: (subscription_id, created_at DESC), index on stripe_invoice_id.

**status_components table:**

| Column | Type | Constraints |
|--------|------|-------------|
| component_id | UUID | PK |
| name | VARCHAR(50) | NOT NULL, UNIQUE |
| display_name | VARCHAR(100) | NOT NULL |
| status | VARCHAR(20) | NOT NULL, DEFAULT 'operational' |
| description | TEXT | NULLABLE |
| sort_order | INTEGER | NOT NULL, DEFAULT 0 |
| updated_at | TIMESTAMPTZ | NOT NULL |

**status_incidents table:**

| Column | Type | Constraints |
|--------|------|-------------|
| incident_id | UUID | PK |
| title | VARCHAR(200) | NOT NULL |
| status | VARCHAR(20) | NOT NULL (investigating, identified, monitoring, resolved) |
| severity | VARCHAR(20) | NOT NULL (minor, major, critical) |
| affected_components | JSONB | NOT NULL (array of component_ids) |
| resolved_at | TIMESTAMPTZ | NULLABLE |
| created_at | TIMESTAMPTZ | NOT NULL |
| updated_at | TIMESTAMPTZ | NOT NULL |

Index: (status, created_at DESC), (created_at DESC).

**incident_updates table:**

| Column | Type | Constraints |
|--------|------|-------------|
| update_id | UUID | PK |
| incident_id | UUID FK | NOT NULL, FK → status_incidents |
| status | VARCHAR(20) | NOT NULL |
| message | TEXT | NOT NULL |
| created_at | TIMESTAMPTZ | NOT NULL |

Index: (incident_id, created_at DESC).

Export all tables and inferred types.

## Prerequisites

This task depends on the following completed tasks: D12-002

## FRD Reference

Domain 12 Section 8.2: Payment history table with 9 columns. GST is 5% of base amount.
Domain 12 Section 5: Status page at status.meritum.ca. Eight monitored components. Incident states: Investigating, Identified, Monitoring, Resolved.

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

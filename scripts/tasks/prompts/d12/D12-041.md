# Task D12-041: Security: authorization and role enforcement

## What to Build

Create `apps/api/test/security/platform/platform.authz.security.ts`.

**Delegate cannot access subscription management:**
- POST /subscriptions/checkout as delegate → 403
- POST /subscriptions/portal as delegate → 403
- GET /subscriptions/current as delegate → 403 (delegates don't have subscriptions)

**Non-admin cannot access admin routes:**
- GET /admin/subscriptions as physician → 403
- PATCH /admin/subscriptions/:id/status as physician → 403
- POST /admin/incidents as physician → 403
- POST /admin/incidents/:id/updates as physician → 403
- PATCH /admin/components/:id/status as physician → 403

**Subscription-gated access (using checkSubscription middleware from D01-030):**
- SUSPENDED user: verify claim creation blocked (403 or 402)
- CANCELLED user: verify all feature access blocked except data export

## Prerequisites

This task depends on the following completed tasks: D12-031, D12-032

## Run After Completion

```bash
pnpm --filter api vitest run test/security/platform/platform.authz.security.ts
```

All tests must pass before outputting [TASK_COMPLETE].

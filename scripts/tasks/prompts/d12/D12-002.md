# Task D12-002: Drizzle schema for subscriptions table

## What to Build

Create `packages/shared/src/schemas/db/platform.schema.ts` starting with the subscriptions table.

**subscriptions table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| subscription_id | UUID | PK | Default: gen_random_uuid() |
| provider_id | UUID FK | NOT NULL, UNIQUE, FK → users | One subscription per physician |
| stripe_customer_id | VARCHAR(50) | NOT NULL | Stripe customer reference |
| stripe_subscription_id | VARCHAR(50) | NOT NULL | Stripe subscription reference |
| plan | VARCHAR(30) | NOT NULL | STANDARD_MONTHLY, STANDARD_ANNUAL, EARLY_BIRD_MONTHLY |
| status | VARCHAR(20) | NOT NULL, DEFAULT 'trial' | TRIAL, ACTIVE, PAST_DUE, SUSPENDED, CANCELLED |
| current_period_start | TIMESTAMPTZ | NOT NULL | Current billing period start |
| current_period_end | TIMESTAMPTZ | NOT NULL | Current billing period end |
| trial_end | TIMESTAMPTZ | NULLABLE | Trial period end if applicable |
| failed_payment_count | INTEGER | NOT NULL, DEFAULT 0 | Consecutive failures, reset on success |
| suspended_at | TIMESTAMPTZ | NULLABLE | When account was suspended |
| cancelled_at | TIMESTAMPTZ | NULLABLE | When subscription was cancelled |
| deletion_scheduled_at | TIMESTAMPTZ | NULLABLE | 30 days after cancellation |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |
| updated_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |

**Indexes:** unique on provider_id, index on stripe_customer_id, index on stripe_subscription_id, index on status, index on deletion_scheduled_at (for cleanup job).

Export the table and inferred types (InsertSubscription, SelectSubscription).

## Critical Security Rules

- Stripe IDs (customer_id, subscription_id) are references only — no payment card data stored in Meritum.
- provider_id is UNIQUE — each physician has exactly one subscription record.
- No PHI is stored in the subscriptions table. This table contains only billing metadata.

## Prerequisites

This task depends on the following completed tasks: D12-001

## FRD Reference

Domain 12 Section 8.1: Subscriptions table with 14 columns. One-to-one with provider.

## Run After Completion

```bash
pnpm --filter shared build
```

All tests must pass before outputting [TASK_COMPLETE].

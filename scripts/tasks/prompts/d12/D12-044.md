# Task D12-044: Security: data leakage prevention (Stripe secrets, PHI isolation)

## What to Build

Create `apps/api/test/security/platform/platform.leakage.security.ts`.

**Stripe data isolation:**
- GET /subscriptions/current does NOT return stripe_customer_id in response
- GET /subscriptions/current does NOT return stripe_subscription_id in response
- GET /subscriptions/payments does NOT return stripe_invoice_id in response
- Payment responses contain only amount, GST, total, status, date â€” no Stripe internals

**PHI isolation verification:**
- Verify no PHI (patient data, claim data, billing codes) appears in any Platform Operations response
- Verify Stripe webhook handler does not log PHI

**Error response sanitisation:**
- 500 errors on subscription endpoints do not expose Stripe API keys or webhook secrets
- 500 errors do not expose database connection strings
- Webhook verification failures return generic 400, not the expected signature

**Header checks:**
- No X-Powered-By header
- No Server header revealing version
- Status page responses include cache headers (public, short TTL)

**Admin responses:**
- Admin subscription list includes Stripe IDs (admin needs these for debugging)
- Non-admin responses never include Stripe IDs

## Prerequisites

This task depends on the following completed tasks: D12-031, D12-032

## Run After Completion

```bash
pnpm --filter api vitest run test/security/platform/platform.leakage.security.ts
```

All tests must pass before outputting [TASK_COMPLETE].

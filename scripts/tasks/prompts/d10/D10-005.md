# D10-005 â€” Database migration for Domain 10 tables

## Task ID
D10-005

## Description
Generate and run Drizzle migration for Domain 10 tables (ed_shifts and favourite_codes).

## Dependencies
- D10-002 (ed_shifts schema)
- D10-003 (favourite_codes schema)

## Build Instructions

Generate and run Drizzle migration for Domain 10 tables.

The migration should create:
1. ed_shifts table with all columns, indexes (including unique partial index for active shift constraint), FK to providers and practice_locations
2. favourite_codes table with all columns, indexes, FK to providers

**Important:** Check if ed_shifts already exists from Domain 4.0 build. If so, skip creation or add any missing columns via ALTER TABLE. The shift_id FK on the claims table should also be added if not already present.

Run `pnpm --filter api drizzle-kit generate` to create migration file.
Run `pnpm --filter api drizzle-kit migrate` to apply.
Verify both tables exist with correct schema.

## FRD References
- Domain 10 Section 2.2: ed_shifts table -- may already exist in Domain 4.0.
- Domain 10 Section 4.1: favourite_codes table.

## Security Requirements
- Unique partial index on ed_shifts (provider_id) WHERE status = 'ACTIVE' is the DB-level enforcement of one active shift.
- FK constraints ensure referential integrity.

## Codebase Context
- DB: PostgreSQL via Drizzle ORM.
- Schemas defined in `packages/shared/src/schemas/db/mobile.schema.ts` (from D10-002 and D10-003).
- The unique partial index `WHERE status = 'ACTIVE'` is critical -- it is the DB-level enforcement that ensures only one active shift per physician at any time.
- Claims from D04 have state machine: draft -> validated -> queued -> submitted -> accepted/rejected. The shift_id FK on claims links mobile shift encounters to the claims table.
- Provider locations from D05 include the practice_locations table referenced by location_id.

## Verification
```bash
pnpm --filter api drizzle-kit generate && pnpm --filter api drizzle-kit migrate
```

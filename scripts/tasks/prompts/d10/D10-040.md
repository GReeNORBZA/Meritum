# D10-040 â€” Security: authentication enforcement on every route

## Task ID
D10-040

## Description
Create security tests verifying that all authenticated Domain 10 routes return 401 without a valid session cookie.

## Dependencies
- D10-030 (shift routes)
- D10-031 (favourite routes)
- D10-032 (mobile routes)

## Build Instructions

Create `apps/api/test/security/mobile/mobile.authn.security.ts`.

Test every authenticated route in Domain 10 returns 401 without a valid session cookie:

**Shift routes:**
- POST /api/v1/shifts
- GET /api/v1/shifts/active
- POST /api/v1/shifts/:id/end
- GET /api/v1/shifts/:id/summary
- GET /api/v1/shifts
- POST /api/v1/shifts/:id/patients

**Favourite routes:**
- GET /api/v1/favourites
- POST /api/v1/favourites
- PUT /api/v1/favourites/:id
- DELETE /api/v1/favourites/:id
- PUT /api/v1/favourites/reorder

**Mobile routes:**
- POST /api/v1/mobile/quick-claim
- POST /api/v1/mobile/patients
- GET /api/v1/mobile/recent-patients
- GET /api/v1/mobile/summary

**Excluded from auth test:**
- POST /api/v1/sync/claims -> returns 501 regardless (unauthenticated OK for Phase 2 reconnection)

For each route (16 total): send request with no cookie, with expired cookie, and with tampered cookie. All must return 401 with no data leakage.

Total assertions: 16 routes x 3 failure modes = 48 test cases.

## Security Requirements
- 401 responses must not contain any data beyond the error object.
- Tampered cookies rejected -- invalid signature.
- Expired sessions return 401, not stale data.
- Sync endpoint excluded -- 501 is acceptable without auth.

## Codebase Context
- Security tests go in `apps/api/test/security/mobile/`.
- Auth pattern: session cookie auth with `request.session.user` containing `{ id, role, physician_id }`.
- See existing security test patterns in `test/security/` from other domains for test setup, cookie tampering, and assertion patterns.
- Fastify 5 + Vitest test framework.

## Verification
```bash
pnpm --filter api vitest run test/security/mobile/mobile.authn.security.ts
```

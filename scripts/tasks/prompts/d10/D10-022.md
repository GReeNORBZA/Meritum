# D10-022 â€” Quick claim service -- mobile claim entry, minimal validation

## Task ID
D10-022

## Description
Create the quick claim service for mobile claim entry with minimal validation, creating AHCIP draft claims only.

## Dependencies
- D10-010 (ED shifts repository)

## Build Instructions

Create `apps/api/src/domains/mobile/services/quick-claim.service.ts` and test file `apps/api/src/domains/mobile/services/quick-claim.service.test.ts`.

**Methods:**

- `createQuickClaim(providerId, data: QuickClaimInput)` -- create a draft AHCIP claim with minimal fields. No full validation run on mobile (desktop handles validation). Claim created via Domain 4 claim service with: patient_id, health_service_code, modifiers, date_of_service, claim_type='AHCIP', state='draft', source='mobile_quick_entry'. Return created claim. Audit log: mobile.quick_claim_created.
- `createMinimalPatient(providerId, data: MobilePatientInput)` -- create patient with minimal fields (first_name, last_name, PHN, DOB, gender) via Domain 3 patient service. For mobile quick-add when patient not yet in registry. Full patient profile editing happens on desktop. Return created patient.
- `getRecentPatients(providerId, limit?)` -- query last 20 patients this physician has billed (by most recent claim date_of_service). Return patient_id, first_name, last_name, PHN. For the 'recent patients' list in quick entry.

**Quick claim data flow:**
1. Mobile creates draft claim with source='mobile_quick_entry'.
2. Claim appears in physician's desktop claim list.
3. On desktop, physician reviews: adds diagnostic codes, runs validation, queues for submission.
4. Mobile never modifies a claim beyond initial creation.

**Unit tests:** quick claim creates draft AHCIP claim, WCB claim type rejected, minimal patient creation, recent patients ordered by recency, claim has source='mobile_quick_entry'.

## FRD References
- Domain 10 Section 3.1: Quick entry flow -- select patient, select code, modifiers, date, save as draft.
- Domain 10 Section 3.2: Quick entry constraints -- AHCIP only, draft state, no validation on mobile, diagnostic codes optional.

## Security Requirements
- Claims created as AHCIP draft only -- WCB via mobile is explicitly out of scope.
- Patient created with PHN -- PHI protection applies. PHN must be unique per physician's registry.
- source='mobile_quick_entry' tag allows audit trail to distinguish mobile-created claims.
- No full validation on mobile prevents mobile from bypassing desktop validation rules.

## Codebase Context
- Service files go in `apps/api/src/domains/mobile/services/`.
- Test pattern: unit tests co-located as `*.test.ts`.
- Claims from D04 (`src/domains/claims/`) have state machine: draft -> validated -> queued -> submitted -> accepted/rejected.
- Patients from D06 (`src/domains/patients/`) provide patient CRUD operations.
- Quick claims are AHCIP-only, always draft state, source='mobile_quick_entry'.
- PHN masking: display as `123******`.
- Audit events: use the existing audit logging infrastructure from D12.
- Auth pattern: session cookie auth with `request.session.user` containing `{ id, role, physician_id }`.

## Verification
```bash
pnpm --filter api vitest run src/domains/mobile/services/quick-claim.service.test.ts
```

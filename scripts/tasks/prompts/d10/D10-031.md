# D10-031 â€” Favourite codes routes -- CRUD and reorder

## Task ID
D10-031

## Description
Create Fastify routes for favourite codes CRUD operations and reorder functionality.

## Dependencies
- D10-021 (favourite codes service)
- D10-004 (Zod validation schemas)

## Build Instructions

Create `apps/api/src/domains/mobile/routes/favourite.routes.ts` and test file `apps/api/src/domains/mobile/routes/favourite.routes.test.ts`.

Register Fastify routes. All require authentication.

**Routes:**

1. `GET /api/v1/favourites` -- list physician's favourites in sort order. Enriched with HSC descriptions. Triggers seeding on first call if empty. Permission: CLAIM_VIEW.
2. `POST /api/v1/favourites` -- body validated by CreateFavouriteSchema. Add favourite. 409 if HSC code already in favourites. 400 if max 30 reached. Permission: CLAIM_CREATE.
3. `PUT /api/v1/favourites/:id` -- body validated by UpdateFavouriteSchema. Update favourite. 404 if not found or wrong provider. Permission: CLAIM_CREATE.
4. `DELETE /api/v1/favourites/:id` -- param validated by FavouriteIdParamSchema. Remove favourite. 404 if not found or wrong provider. Permission: CLAIM_CREATE.
5. `PUT /api/v1/favourites/reorder` -- body validated by ReorderFavouritesSchema. Bulk reorder. Permission: CLAIM_CREATE.

**Route-level unit tests:** CRUD operations, 409 on duplicate, 400 on max 30, auto-seed on first GET, reorder bulk update.

## FRD References
- Domain 10 Section 8.2: Favourite codes endpoints (Table 7).
- Domain 10 Section 4.2: Favourites management -- add, remove, reorder, max 30.

## Security Requirements
- Provider scoping -- favourites only accessible by owning physician.
- Wrong provider returns 404 not 403.
- Auto-seed on first GET is provider-scoped -- seeds from own claim history only.

## Codebase Context
- Route files go in `apps/api/src/domains/mobile/routes/`.
- Test pattern: unit tests co-located as `*.test.ts`.
- Auth pattern: session cookie auth with `request.session.user` containing `{ id, role, physician_id }`. Roles: physician, delegate, admin.
- Zod validation schemas from `packages/shared/src/schemas/validation/mobile.validation.ts` (D10-004).
- Favourites max 30 per physician, auto-seed from top 10 billed codes.
- Reference Data from D02 includes health service codes with fee schedule amounts.
- See existing route patterns in other domains for Fastify route registration.

## Verification
```bash
pnpm --filter api vitest run src/domains/mobile/routes/favourite.routes.test.ts
```

# D10-011 â€” Favourite codes repository -- CRUD, reorder, seeding

## Task ID
D10-011

## Description
Create the favourite codes repository with CRUD operations, reorder support, and bulk seeding.

## Dependencies
- D10-005 (migration must be applied first)

## Build Instructions

Create `apps/api/src/domains/mobile/repos/favourite-codes.repo.ts` and test file `apps/api/src/domains/mobile/repos/favourite-codes.repo.test.ts`.

**Methods (all require providerId):**

- `create(data: InsertFavouriteCode)` -- create new favourite. Throws on unique constraint violation (duplicate HSC code for this provider). Validates count < 30 before insert.
- `getById(favouriteId, providerId)` -- fetch by ID scoped to provider. Null for wrong provider (404 pattern).
- `update(favouriteId, providerId, data: Partial)` -- update display_name, default_modifiers, sort_order.
- `delete(favouriteId, providerId)` -- hard delete. Return boolean success.
- `listByProvider(providerId)` -- list all favourites ordered by sort_order ASC.
- `reorder(providerId, items: {favourite_id, sort_order}[])` -- bulk update sort_order for multiple favourites in a single transaction. Validates all favourite_ids belong to this provider.
- `countByProvider(providerId)` -- return count of favourites. Used for max-30 enforcement.
- `bulkCreate(providerId, items: InsertFavouriteCode[])` -- batch insert for initial seeding. Used when auto-seeding from claim history or specialty defaults.

**Unit tests:** create enforces unique constraint, max 30 enforcement, CRUD operations, reorder updates all sort_orders, bulkCreate seeds correctly, provider scoping.

## FRD References
- Domain 10 Section 4.1: Favourites data model (Table 2).
- Domain 10 Section 4.2: Add/remove, reorder via drag-and-drop, max 30, default modifiers per favourite.
- Domain 10 Section 8.2: Favourite codes API endpoints (Table 7).

## Security Requirements
- Max 30 favourites enforced at repo level (count check before insert) and application level.
- reorder validates all favourite_ids belong to the calling provider -- prevents reordering other physicians' favourites.
- hard delete is acceptable -- favourites are not PHI.

## Codebase Context
- Repository files go in `apps/api/src/domains/mobile/repos/`.
- Test pattern: unit tests co-located as `*.test.ts`.
- DB: PostgreSQL via Drizzle ORM. The favourite_codes schema is in `packages/shared/src/schemas/db/mobile.schema.ts`.
- Favourites max 30 per physician, auto-seed from top 10 billed codes.
- Reference Data from D02 includes health service codes with fee schedule amounts.
- The UNIQUE constraint on (provider_id, health_service_code) prevents duplicate favourites at the DB level.

## Verification
```bash
pnpm --filter api vitest run src/domains/mobile/repos/favourite-codes.repo.test.ts
```

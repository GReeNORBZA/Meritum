# D10-002 â€” Drizzle schema for ed_shifts table

## Task ID
D10-002

## Description
Create the Drizzle schema for the `ed_shifts` table in the shared package.

## Dependencies
- D10-001 (constants must exist first)

## Build Instructions

Create `packages/shared/src/schemas/db/mobile.schema.ts` starting with the `ed_shifts` table.

**ed_shifts table:**

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| shift_id | UUID | PK | Default: gen_random_uuid() |
| provider_id | UUID FK | NOT NULL | FK to providers. Indexed. |
| location_id | UUID FK | NOT NULL | FK to practice_locations. The ED facility. |
| shift_start | TIMESTAMPTZ | NOT NULL | When the shift started |
| shift_end | TIMESTAMPTZ | NULLABLE | When the shift ended. Null while active. |
| patient_count | INTEGER | NOT NULL, DEFAULT 0 | Running count of patients logged |
| estimated_value | DECIMAL(10,2) | NOT NULL, DEFAULT 0 | Running sum of expected fees |
| status | VARCHAR(20) | NOT NULL, DEFAULT 'ACTIVE' | ACTIVE, ENDED, REVIEWED |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | |

**Indexes:**
- UNIQUE partial index on (provider_id) WHERE status = 'ACTIVE' -- enforces max one active shift per physician
- Index on (provider_id, status) for active shift lookups
- Index on (provider_id, created_at DESC) for shift history listing

**Note:** The FRD states ed_shifts is part of Domain 4.0 data model. If the table already exists from Domain 4.0 build, import it here and extend if needed. If it doesn't exist yet, create it in this domain. The important thing is that claims reference shift_id via FK.

Export table and inferred types (InsertEdShift, SelectEdShift).

After creating the schema, update the barrel export at `packages/shared/src/schemas/db/index.ts` and `packages/shared/src/schemas/index.ts`.

## FRD References
- Domain 10 Section 2.2: Shift session data -- ed_shifts table schema (Table 1).
- Domain 10 Section 2.1: Only one active shift per physician at a time.

## Security Requirements
- Unique partial index on (provider_id) WHERE status = 'ACTIVE' enforces the one-active-shift constraint at DB level.
- provider_id scoping on all queries -- physician can only see their own shifts.
- location_id FK validates the ED facility exists and belongs to the physician's practice locations.

## Codebase Context
- DB: PostgreSQL via Drizzle ORM. Schemas in `packages/shared/src/schemas/db/`.
- Existing domain schemas provide patterns: D04 claims, D05 providers (practice_locations table), D06 patients.
- The unique partial index `WHERE status = 'ACTIVE'` is a critical architectural decision for enforcing one active shift per physician at the DB level.
- Provider locations from D05 include the `practice_locations` table that `location_id` references.
- All barrel exports must be updated: `packages/shared/src/schemas/db/index.ts`, `packages/shared/src/schemas/index.ts`.

## Verification
```bash
pnpm --filter shared build
```

# D10-043 â€” Security: input validation -- injection, type coercion, boundary values

## Task ID
D10-043

## Description
Create security tests verifying input validation against SQL injection, XSS, type coercion attacks, UUID validation, and boundary values on all Domain 10 endpoints.

## Dependencies
- D10-030 (shift routes)
- D10-031 (favourite routes)
- D10-032 (mobile routes)

## Build Instructions

Create `apps/api/test/security/mobile/mobile.input.security.ts`.

**SQL injection attempts:**
- location_id: `'; DROP TABLE ed_shifts; --` -> 400
- health_service_code: `03.04A'; DELETE FROM favourite_codes; --` -> 400
- patient_id: injection payload -> 400
- shift_id param: injection payload -> 400

**XSS attempts:**
- display_name: `<script>alert('xss')</script>` -> 400 or sanitised
- quick_note: `<img onerror=alert(1)>` -> 400 or sanitised
- first_name / last_name: HTML injection -> 400 or sanitised

**Type coercion attacks:**
- location_id: integer instead of UUID -> 400
- sort_order: string instead of integer -> 400
- default_modifiers: string instead of array -> 400
- limit: negative number -> 400

**UUID validation:**
- All ID params: 'not-a-uuid' -> 400
- Malformed UUID -> 400

**Boundary values:**
- display_name: 101 chars -> 400 (max 100)
- quick_note: 501 chars -> 400 (max 500)
- PHN: 8 digits -> 400 (must be exactly 9)
- PHN: 10 digits -> 400
- PHN: letters -> 400
- date_of_service: future date -> 400
- date_of_birth: future date -> 400
- sort_order in reorder: negative -> 400
- reorder items: 31 items -> 400 (max 30)
- gender: invalid value -> 400 (must be M, F, or X)

All invalid inputs return 400 with generic error messages.

## Security Requirements
- All queries parameterised via Drizzle -- no string concatenation.
- Validation at route level before any DB access.
- PHN is 9 digits -- strict format prevents injection.

## Codebase Context
- Security tests go in `apps/api/test/security/mobile/`.
- Zod validation schemas from `packages/shared/src/schemas/validation/mobile.validation.ts` handle input validation at the route level.
- All queries use parameterised Drizzle ORM -- no raw SQL string concatenation.
- See existing input security tests in `test/security/` from other domains for test patterns.
- Fastify 5 + Vitest test framework.

## Verification
```bash
pnpm --filter api vitest run test/security/mobile/mobile.input.security.ts
```
